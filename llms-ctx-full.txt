<project title="pote" summary="A collection of battle-tested Python utilities extracted from real projects.">`pote` provides utilities that solve common problems across data manipulation, callbacks, configuration, display, and widgets. These are practical helpers too useful to keep copying between projects, but don't justify their own library.

Here are some highlights:

- **Nested data access**: Use `val_at(data, 'user.scores.1')` for safe navigation through nested dicts and lists with dot notation
- **Attribute dicts**: Replace plain dicts with `AD` to access values as attributes (`config.debug` instead of `config['debug']`)
- **Callback system**: Add side-effects to any object without modifying its code using `HasCallbacks` mixin
- **Iteration tracking**: Wrap any iterable with `CollBack` to automatically track progress and timing
- **Simple config management**: Use `Config` for app settings with context manager support for temporary changes
- **Rich Jupyter integration**: Enhanced display functions for collapsible JSON, styled output, and custom CSS
- **Async widget helpers**: Utilities for using ipywidgets with async code and blocking input in notebooks<docs><doc title="README" desc="Quick start guide and overview"># pote



``` sh
pip install pote
```

A collection of battle-tested (well, by me in my projects) Python
utilities extracted from real projects. These are practical helpers that
solve common problems across data manipulation, callbacks,
configuration, display, and widgets.

## What is pote?

`pote` provides utilities that don’t justify their own library but are
too useful to keep copying between projects. Each module is focused,
well-tested, and designed for immediate use.

## Modules

### Core Utilities

- **[basic](basic.html)** - Fundamental Python utilities: nested data
  access ([`val_at`](https://civvic.github.io/pote/basic.html#val_at),
  [`vals_at`](https://civvic.github.io/pote/basic.html#vals_at)), dict
  helpers, string utilities, type checking, and more
- **[test](test.html)** - Testing helpers beyond fastcore:
  [`test_raises`](https://civvic.github.io/pote/test.html#test_raises),
  [`test_afail`](https://civvic.github.io/pote/test.html#test_afail),
  [`test_is_not`](https://civvic.github.io/pote/test.html#test_is_not)
- **[project](project.html)** - Project setup utilities: global console
  configuration with Rich theme support

### Advanced Features

- **[callback](callback.html)** - Callback system for augmenting objects
  with side-effects, plus
  [`CollBack`](https://civvic.github.io/pote/callback.html#collback) for
  tracking iteration with callbacks
- **[config](config.html)** - Simple namespace for configuration with
  context manager for temporary changes
- **[display](display.html)** - Jupyter display enhancements: Rich
  integration, collapsible JSON rendering, CSS generation
- **[widgets](widgets.html)** - ipywidgets utilities: widget cleanup,
  async support, blocking input helpers (requires
  `pip install pote[widgets]`)
- **[logger_loguru](logger_loguru.html)** - Loguru configuration helpers
  for structured logging with hierarchical indentation (requires
  `pip install pote[logging]`)

## Quick Start

``` python
from pote.basic import val_at, AD, shorten
from pote.callback import CollBack

# Access nested data with dot notation
data = {'user': {'name': 'Alice', 'scores': [10, 20, 30]}}
val_at(data, 'user.scores.1')  # 20

# Dict with attribute access
config = AD(debug=True, timeout=30)
config.debug  # True

# Track iteration with callbacks
for item in CollBack(range(100)):
    process(item)
    # Progress tracked automatically
```

## Installation

``` sh
pip install pote
```

## Development

These utilities are developed with notebooks using
[nbdev](https://nbdev.fast.ai/). Browse the
[notebooks](https://github.com/yourusername/pote/tree/main/nbs) to see
implementation and examples.

## Philosophy

- **Copy-friendly**: See something useful? Copy it with my blessing
- **Battle-tested**: Extracted from production projects
- **Documented through tests**: Examples serve as both tests and
  documentation</doc></docs><api><doc title="API List" desc="A succint list of all functions and methods in pote."># pote Module Documentation

## pote.basic

> Fundamental Python utilities for data manipulation, type checking, and common operations

- `class Empty`

- `class EmptyT`

- `class AD`
    `dict` subclass that also provides access to keys as attrs

    - `def __getattr__(self, k)`
    - `def __setattr__(self, k, v)`
    - `def __dir__(self)`
    - `def copy(self)`

- `def flatten(o)`
    Concatenate all collections and items as a generator

- `def Runner(*fns)`
    Return a function that runs callables `fns` in sequence with same arguments. 
    Only side-effects, no composition.

- `def setattrs(dest, src, flds)`
    Set `flds` or keys() or dir() attributes from `src` into `dest`

- `def val_at(o, attr, default, sep)`
    Traverse nested `o` looking for attributes/items specified in dot-separated `attr`.

- `def val_atpath(o, *path)`
    Traverse nested `o` looking for attributes/items specified in `path`.

- `def has_key(o, attr, sep)`
    Return `True` if nested dot-separated `attr` exists.

- `def has_path(o, *path)`
    Return `True` if nested `path` exists.

- `def vals_atpath(o, *path)`
    Return nested values-- or empty|(empty, ...)-- at `path` with wildcards '*' from `d`.

- `def vals_at(o, path, filter_empty)`
    Return nested values-- or empty|(empty, ...)-- at `path` with wildcards '*' from `o`.

- `def deep_in(o, val)`
    return True if val is in nested collections

- `def pops_(d, *ks)`
    Pop existing `ks` items from `d` in-place into a dictionary.

- `def pops_values_(d, *ks)`
    Pop existing `ks` items from `d` in-place into a tuple of values or `Parameter.empty` for missing keys.

- `def gets(d, *ks)`
    Fetches `ks` values, or `Parameter.empty` for missing keys, from `d` into a tuple.

- `def update_(empty_value, **kwargs)`
    Update `dest` in-place with `kwargs` whose values aren't `empty_value`

- `def bundle_path(mod)`
    Return the path to the module's directory or current directory.

- `class Kounter`
    - `def __init__(self)`
    - `def __call__(self, k)`

- `class WithCounterMeta`
    Adds a `_cnt_` attribute to its classes and increments it for each new instance.

    - `def __call__(cls, *args, **kwargs)`
    - `def __new__(cls, name, bases, dict)`

## pote.callback

> Extensible callback system for augmenting objects and tracking iterations

- `class Callback`
    Base class of callbacks.


- `def run_cbs(cbs, method_nm, ctx, *args, **kwargs)`
    Run `method_nm(ctx, ...)` of each callback in `cbs` in order.

- `class EchoCB`
    Print the arguments.

    - `def echo(self, ctx, *args, **kwargs)`
    - `def __getattr__(self, name)`

- `class FuncCB`
    Store functions that can be called as callbacks.

    - `def __init__(self, **kwargs)`

- `class PassCB`
    A callback that does nothing.

    - `def noop(self, *args, **kwargs)`
    - `def __getattr__(self, name)`

- `class HasCallbacks`
    Base for classes that can be augmented with callbacks.

    - `def __new__(cls, *args, **kwargs)`
    - `def __init__(self, cbs)`
    - `def with_cbs(self, cbs, extend)`
    - `@contextmanager def this_cbs(self, cbs)`
        Use temporary `cbs` in `with` block.

    - `def __getattr__(self, name)`
        Run `name` as a callback if it's in `self.cbs_names`.

    - `def callback(self, method_nm, *args, **kwargs)`

- `class with_cbs`
    Decorator to add callbacks to a method.

    - `def __init__(self, nm)`
    - `def __call__(self, f)`

- `class CollBack`
    Track iterables and extend them with callbacks.

    - `def __init__(self, source, total, context, **kwargs)`
    - `@property def progress`
    - `@property def state`
    - `def __repr__(self)`
    - `def __iter__(self)`
    - `def trackback(self, cbs)`

- `def process_(cbs, slc, pred, context, **kwargs)`
    Process a subset `slc` of `iterable` filtered by `pred` with callbacks from `cbs` and `FuncCB` `kwargs`

## pote.config

> Configuration container with temporary context manager for scoped changes

- `class Config`
    Store of arbitrary values

    - `def __repr__(self)`
    - `def update(self, **kwargs)`
    - `def as_dict(self)`
    - `@contextmanager def __call__(self, **kwargs)`

## pote.display

> Rich display utilities and dynamic CSS for Jupyter notebooks

- `class RenderJSON`
    - `def __init__(self, json_data, max_height, init_level)`
    - `def display(self)`

- `class GlobalCSS`
    - `def has_style(self, name)`
    - `@property def css`
    - `def add(self, name, css, update)`
    - `def update(self, name, css)`
    - `def display(self)`
    - `def __init__(self, css)`

## pote.logger_loguru

> Loguru configuration helpers for structured logging with indentation

- `class LogFormatter`
    Formats log records with indentation for tree-structured output

    - `def __init__(self)`
    - `def format(self, record)`
        Format record with current indentation level


- `class LogLevelFilter`
    Filter log records by minimum level with context manager for temporary override

    - `def __init__(self, level)`
    - `def __call__(self, record)`
        Return True if record meets minimum level threshold

    - `@contextmanager def temp(self, tmp_level)`
        Temporarily override filter level within context


- `class tree_logger`
    Logger wrapper managing hierarchical indentation for tree-structured output

    - `def __init__(self, logger, fmt)`
    - `@property def level`
        Current indentation level (0=root)

    - `@property def indent`
        Current indentation string using box drawing chars

    - `def __getattr__(self, name)`
        Proxy logger methods with indent bound; handle push/pop

    - `def reset(self)`
        Reset indentation to root level

    - `@contextmanager def inc_indent(self)`
        Context manager temporarily increasing indent by one level

    - `def bracket_logging(self, header_f, *attr_n)`
        Decorator for async methods: log entry with indent, auto-pop on exit


- `def setup_logger(logger, name)`
    Apply standard config (format, level filter, backtrace) to logger

- `def config_logger(logger)`
    Configure logger with colors and return (logger, tree_logger) tuple

## pote.project

> Global console configuration for consistent output across projects

- `def get_console()`
    Globally configured console

## pote.test

> Additional test utilities complementing `fastcore.test`

- `def test_is_not(a, b)`
    `test` that `a is not b`

## pote.widget

> Utilities for ipywidgets: cleanup, async interaction, and blocking input

- `class Clickable`
    Button with value.

    - `def __init__(self, description, **kwargs)`

- `def yield_for_change(widget, attribute)`
    Pause a generator to wait for a widget change event.
        
    This is a decorator for a generator function which pauses the generator on yield
    until the given widget attribute changes. The new value of the attribute is
    sent to the generator and is the value of the yield.
</doc></api><optional><doc title="Basic helpers" desc="Fundamental utilities for data manipulation and type handling"># Basic




------------------------------------------------------------------------

# Type Utilities

## empty

A sentinel value for distinguishing “no value provided” from `None`.
Useful in function signatures where `None` is a valid argument.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L51"
target="_blank" style="float:right; font-size:smaller">source</a>

### is_empty

>  is_empty (x)

``` python
test_is(str(empty), 'empty')
empty
```

    empty

``` python
def test_empty() -> Empty: return empty
test_eq_type(test_empty(), empty)
```

# Data Structures

## AD

Attribute Dict - a dictionary that also allows attribute-style access.
Perfect for configuration objects or API responses where you want both
`config['key']` and `config.key` syntax.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L56"
target="_blank" style="float:right; font-size:smaller">source</a>

### AD

*`dict` subclass that also provides access to keys as attrs*

``` python
# Basic usage: dict and attribute access
ad = AD(a=1, b=2)
test_eq(ad.a, 1)
test_eq(ad['a'], 1)

ad.b = 3
test_eq(ad.b, 3)
ad.update(a=4, b=5)
test_eq(ad.b, 5)
```

``` python
# Edge cases: empty dict, missing keys
ad = AD()
test_fail(lambda: ad.a)
test_fail(lambda: ad['b'])
```

## is_listy

Test whether `x` is iterable but not a string or bytes. Useful for
duck-typing checks where you want to handle collections but not strings.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L68"
target="_blank" style="float:right; font-size:smaller">source</a>

### is_listy_type

>  is_listy_type (x)

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L65"
target="_blank" style="float:right; font-size:smaller">source</a>

### is_listy

>  is_listy (x)

``` python
# Common usage: distinguish collections from strings
test_is(is_listy([1, 2, 3]), True)
test_is(is_listy((1, 2, 3)), True)
test_is(is_listy({'a': 1}), True)
test_is(is_listy('hello'), False)  # strings are NOT listy
test_is(is_listy(b'bytes'), False)  # bytes are NOT listy
test_is(is_listy(None), False)
```

``` python
# Coverage: ranges, generators, and type checking
test_is(is_listy(range(3)), True)
test_is(is_listy((i for i in range(3))), True)
test_is(is_listy(FC.L(1, 2, 3)), True)
test_is(is_listy({1, 2, 3}), True)
test_is(is_listy(r'raw string'), False)

test_is(is_listy_type(list), True)
test_is(is_listy_type(tuple), True)
test_is(is_listy_type(dict), True)
test_is(is_listy_type(str), False)
test_is(is_listy_type(NoneType), False)
```

## flatten

Recursively flatten nested collections into a single generator. Unlike
`itertools.chain`, handles arbitrarily nested structures.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L72"
target="_blank" style="float:right; font-size:smaller">source</a>

### flatten

>  flatten (o)

*Concatenate all collections and items as a generator*

``` python
# Basic usage: flatten arbitrarily nested structures
test_eq(list(flatten([1, 2, 3])), [1, 2, 3])  # already flat
test_eq(list(flatten([1, [2, 3]])), [1, 2, 3])
test_eq(list(flatten([[1], [2], [3]])), [1, 2, 3])
test_eq(list(flatten((1, (2, 3)))), [1, 2, 3])  # works with tuples
test_eq(list(flatten([('a', (2,)), ('c', (4,))])), ['a', 2, 'c', 4])
```

``` python
# Coverage: empty list
test_eq(list(flatten([])), [])
```

# String Utilities

## shorten

Truncate strings intelligently from left, right, or center. Useful for
displaying long identifiers, paths, or data in logs and UIs.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L90"
target="_blank" style="float:right; font-size:smaller">source</a>

### shortens

>  shortens (xs:Iterable[Any], mode:Literal['l','r','c']='l', limit=40,
>                trunc='…', empty='')

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L80"
target="_blank" style="float:right; font-size:smaller">source</a>

### shorten

>  shorten (x:Any, mode:Literal['l','r','c']='l', limit=40, trunc='…',
>               empty='')

``` python
# Basic usage: truncate from left (default), right, or center
uuid = 'ad2663b4-5ff5-40e3-a6ed-cc35f5627f8d'
test_eq(shorten(uuid, limit=17), '…a6ed-cc35f5627f8d')  # left truncation (default)
test_eq(shorten(uuid, 'r', limit=17), 'ad2663b4-5ff5-40e…')  # right truncation
test_eq(shorten(uuid, 'c', limit=17), 'ad2663b … 5627f8d')  # center truncation

test_eq(shorten('It was the best of times', limit=12), '…est of times')
```

``` python
# Coverage: short strings (no truncation), numbers, empty
test_eq(shorten(0), '0')
test_eq(shorten(234), '234')
test_eq(shorten('asdfgh'), 'asdfgh')  # under limit, no change
```

``` python
test_eq(list(shortens(['ad2663b4-5ff5-40e3-a6ed-cc35f5627f8d'], 'l', 10)), ['…35f5627f8d'])
test_eq(list(shortens(('abcdef', 'wertyu', 'sd'), 'r', 4)), ['abcd…', 'wert…', 'sd'])
test_eq(''.join(shortens('It was the best of times...'.split(), 'r', 1, '')), 'Iwtbot')
```

# Function Composition

## Runner

Create a function that runs multiple callables in sequence with the same
arguments. Useful for side-effects like logging, validation, and updates
without explicit chaining.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L97"
target="_blank" style="float:right; font-size:smaller">source</a>

### Runner

>  Runner (*fns:Union[Callable,Sequence[ForwardRef('_FuncItem')]])

*Return a function that runs callables `fns` in sequence with same
arguments. Only side-effects, no composition.*

``` python
def f1(o,x,y=0): o.r += x+y
def f2(o,x,y=0): o.r += x*y
f3 = lambda o, x,y: print(o.r)

o = SimpleNamespace(r=0)
runner = Runner(f1, f2, f3)
runner(o, 2, 3)  # 11

Runner()(o, 2, 3)
test_eq(o.r, 11)
Runner([f1, f2], f3)(o, 2, 3)
test_eq(o.r, 22)
Runner([f1, [f2, f3]])(o, 2, 3)
test_eq(o.r, 33)
```

    11
    22
    33

# Object Utilities

Helpers for manipulating objects and their attributes.

## setattrs

Copy attributes from one object/dict to another. Works bidirectionally:
can copy from dict→object, object→dict, object→object, or dict→dict.

**Common use cases:** - Initialize objects from configuration dicts -
Copy specific fields between instances - Hydrate objects from API
responses

**Parameters:** - `dest`: Target object or dict to set attributes on -
`src`: Source object or dict to read from - `flds`: Comma-separated
field names (optional; defaults to all keys/public attrs)

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L108"
target="_blank" style="float:right; font-size:smaller">source</a>

### setattrs

>  setattrs (dest, src, flds='')

*Set `flds` or keys() or dir() attributes from `src` into `dest`*

``` python
class A: a = 1; b = 2; c = 3
a = A()
setattrs(a, {'b': 22, 'd': 44})
test_eq(a.a, 1)
test_eq(a.b, 22)
test_eq(a.c, 3)
test_eq(a.d, 44)  # type: ignore
```

## val_at - Implementation Evolution

The following cells document the development process of
[`val_at`](https://civvic.github.io/pote/basic.html#val_at), showing how
the implementation evolved to handle increasingly complex cases (dicts →
lists → mixed → JSON strings). This section is preserved for design
rationale but can be skipped by most users.

**Skip to [Nested Data Access](#nested-data-access) if you just want to
use the function.**

### Initial attempt: Simple dict-only version

``` python
def val_at(element, json):
    return reduce(operator.getitem, element.split('.'), json)

j = {"app": {
    "Garden": {
        "Flowers": {
            "Red flower": "Rose",
            "White Flower": "Jasmine",
            "Yellow Flower": "Marigold"
        }
    },
    "Fruits": {
        "Yellow fruit": "Mango",
        "Green fruit": "Guava",
        "White Flower": "groovy"
    },
    "Trees": {
        "label": {
            "Yellow fruit": "Pumpkin",
            "White Flower": "Bogan"
        }
    }
}}

test_eq(val_at('app.Garden.Flowers.White Flower', j), 'Jasmine')
```

``` python
print((dp := 'app.Garden.Flowers'), reduce(operator.getitem, dp.split('.'), j))
```

    app.Garden.Flowers {'Red flower': 'Rose', 'White Flower': 'Jasmine', 'Yellow Flower': 'Marigold'}

``` python
def val_at(element, j:str):
    d = json.loads(j)
    return reduce(lambda d, k: d[k] if isinstance(d, Mapping) else d[int(k)], element.split('.'), d)

j2 = {"app": {
    "Garden": {
        "Flowers": {
            "Red flower": "Rose",
            "White Flower": "Jasmine",
            "Yellow Flower": "Marigold"
        }
    },
    "Fruits": {
        "Yellow fruit": ["Mango", {"Banana": ["Canary Island", "Puerto Rico"]}],
        "Green fruit": "Guava",
        "White Flower": "groovy"
    },
    "Trees": {
        "label": {
            "Yellow fruit": "Pumpkin",
            "White Flower": "Bogan"
        }
    }
}}
test_eq(val_at('app.Fruits.Yellow fruit.1.Banana.0', json.dumps(j2)), 'Canary Island')
```

``` python
apollo_astronauts = json.loads(Path('static/apollo_astronauts.json').read_text())
print((dp := 'Apollo 11.Michael Collins'), reduce(operator.getitem, dp.split('.'), apollo_astronauts))
```

    Apollo 11.Michael Collins {'Experience': 'Pilot on Gemini 10 and Command Module pilot on Apollo 11.', 'Place in history': 'Collins was the first person to perform two EVAs in one mission.', 'Fast fact': 'Collins says his "secret terror" was returning to Earth alone if the surface mission failed.', 'Lunar wisdom': 'I really believe that if the political leaders of the world could see their planet from a distance of 100,000 miles their outlook could be fundamentally changed. That all-important border would be invisible, that noisy argument silenced.'}

``` python
_T = TypeVar('_T')
_II = isinstance
def _at(d: Mapping|Sequence, k: str) -> Any: return (
    d[k] if _II(d, Mapping) else 
    d[int(k)] if _II(d, Sequence) and not _II(d, (str, bytes)) else 
    FC.stop(KeyError))  # type: ignore

def val_at(key_path: str, j: Mapping|Sequence|str|bytes|bytearray, default:_T=empty, sep:str='.') -> _T:
    "Return nested value at `key_path` from `j`. Raise if not found or `default` if not `empty`."
    try: return reduce(_at, key_path.split(sep), json.loads(j) if _II(j, (str, bytes, bytearray)) else j)
    except (KeyError, IndexError, ValueError) as e:
        if default is not empty: return default
        raise e

def key_at(key_path: str, j: Mapping|Sequence|str|bytes|bytearray, sep:str='.') -> bool:
    "Return `True` if nested `key_path` exists in `j`."
    try:
        reduce(_at, key_path.split(sep), json.loads(j) if _II(j, (str, bytes, bytearray)) else j)
        return True
    except (KeyError, IndexError):
        return False
```

``` python
FC.test_fail(lambda: val_at(object, {}))  # type: ignore
FC.test_fail(lambda: val_at(object, []))  # type: ignore
FC.test_fail(lambda: val_at(object, object))  # type: ignore
FC.test_fail(lambda: val_at('', {}))
FC.test_fail(lambda: val_at('', []))
FC.test_fail(lambda: val_at('', object))   # type: ignore

FC.test_fail(lambda: val_at('a.b', {'a': 1}))
test_eq(val_at('a.b', {'a': 1}, None), None)
```

``` python
d = [
    {'a': 1, 'b': [2,  3], 'c': {'d':   4}}, 
    {'a': 5, 'b': [6,  7],                 'd': [{'e': 81}, {'e': 82}]}, 
    {'a': 9, 'b': [10, 11], 'c': {'d': 12}}
]

test_fail(lambda: val_at('', d))
test_fail(lambda: val_at(object, d))  # type: ignore

test_fail(lambda: val_at('', object))  # type: ignore

test_eq(val_at('0.a', d), 1)
test_eq(val_at('1.b', d), [6, 7])
test_eq(val_at('2.c', d), {'d': 12})
```

``` python
j2 = {
    "app": {
        "Garden": {
            "Flowers": {
                "Red flower": "Rose",
                "White Flower": "Jasmine",
                "Yellow Flower": "Marigold"
            }
        },
        "Fruits": {
            "Yellow fruit": ["Mango", {"Banana": ["Canary Island", "Puerto Rico"]}],
            "Green fruit": "Guava",
            "White Flower": "groovy"
        },
        "Trees": {
            "label": {
                "Yellow fruit": "Pumpkin",
                "White Flower": "Bogan"
            }
        },
        "Numbers": [1, 2, 3, 4, 5],
        "Boolean": True,
        "Null": None
    }
}

j2_str = json.dumps(j2)

test_eq(val_at('app.Fruits.Yellow fruit.1.Banana.0', j2_str), 'Canary Island')
test_eq(val_at('app.Garden.Flowers.Red flower', j2_str), 'Rose')
test_eq(val_at('app.Numbers.2', j2_str), 3)
test_eq(val_at('app.Boolean', j2_str), True)
test_eq(val_at('app.Null', j2_str), None)
test_fail(lambda: val_at('app.NonExistent', j2_str))
test_fail(lambda: val_at('app.Fruits.Yellow fruit.3', j2_str))
test_is(val_at('app.Fruits.Yellow fruit.3', j2_str, None), None)

test_eq(key_at('app.Garden.Flowers.Red flower', j2_str), True)
test_eq(key_at('app.Numbers.2', j2_str), True)
test_eq(key_at('app.Fruits.Yellow fruit.1.Banana.0', j2_str), True)
test_eq(key_at('app.NonExistent', j2_str), False)
test_eq(key_at('app.Fruits.Yellow fruit.3', j2_str), False)
```

## vals_at - Implementation Evolution

Similar to [`val_at`](https://civvic.github.io/pote/basic.html#val_at),
this section shows the iterative development of wildcard path traversal.
The implementation needed to handle returning empty sentinels for
missing paths while still extracting values from partial matches.

**Skip to [vals_at, vals_atpath](#vals_at-vals_atpath) for the final
implementation and usage examples.**

### Early wildcard implementation

``` python
_E = object()

def vals_at(path, d) -> empty | tuple[empty | object, ...] | object:
    "Return nested values-- or empty|(empty, ...)-- at `path` with wildcards '*' from `d`."
    curr, wc, rest = str(path).partition('*')
    if not wc and not rest:  return o if (o := val_at(curr, d, _E)) is not _E else empty
    o = val_at(curr.rstrip('.'), d, _E) if curr else d
    try: return (tuple(map(lambda x: empty if (res := vals_at(rest.lstrip('.'), x)) is _E else res, o))  # type: ignore
        if rest and o is not _E else o)
    except TypeError: return empty

test_eq(vals_at('a', object), empty)
```

``` python
d = [
    {'a': 1, 'b': [2,  3],  'c': {'d':   4}}, 
    {'a': 5, 'b': [6,  7],                  'd': [{'e': 81}, {'e': 82}]}, 
    {'a': 9, 'b': [10, 11], 'c': {'d': 12}}
]

test_eq(vals_at('', d), empty)
test_eq(vals_at(object, d), empty)
test_eq(vals_at('*', d), (*d,))
test_eq(vals_at(2, d), d[2])
test_eq(vals_at('a', d), empty)
test_eq(vals_at('*.a', []), ())
test_eq(vals_at('*.a.*.b', [{'a': object}]), (empty,))

test_eq(vals_at('*,a', d), (empty, empty, empty))
test_eq(vals_at('*.a', d), (1, 5, 9))
test_eq(vals_at('*.a.*', d), (1,5,9))
test_eq(vals_at('*.b.1', d), (3, 7, 11))
test_eq(vals_at('*.c.d', d), (4, empty, 12))

test_eq(vals_at('*.d.*.e', d), (empty, (81, 82), empty))
test_eq(vals_at('*.d.*.f', d), (empty, (empty, empty), empty))
test_eq(vals_at('1.d.*.e', d), (81, 82))
```

``` python
vals_at('*', d)
```

    [{'a': 1, 'b': [2, 3], 'c': {'d': 4}},
     {'a': 5, 'b': [6, 7], 'd': [{'e': 81}, {'e': 82}]},
     {'a': 9, 'b': [10, 11], 'c': {'d': 12}}]

# Nested Data Access

Working with deeply nested data (JSON, API responses, config files)
often requires verbose, error-prone access patterns. These utilities
provide clean, safe access using dot notation or path sequences.

## val_at, val_atpath

Lookup values in nested structures using dot notation
([`val_at`](https://civvic.github.io/pote/basic.html#val_at)) or path
sequences
([`val_atpath`](https://civvic.github.io/pote/basic.html#val_atpath)).

**Why use these?** - Cleaner than chained `['key1']['key2'][0]` access -
Safe default values instead of try/except blocks - Works with dicts,
lists, objects, and JSON strings - Handles mixed nesting (lists within
dicts, etc.)

**Use [`val_at`](https://civvic.github.io/pote/basic.html#val_at)** when
you have a dot-separated path string: `'user.addresses.0.city'`  
**Use
[`val_atpath`](https://civvic.github.io/pote/basic.html#val_atpath)**
when you have individual path components:
`'user', 'addresses', 0, 'city'`

**Related utilities:** - `has_key(o, 'dot.path')` /
`has_path(o, *path)` - Check if path exists without retrieving value -
`vals_at(o, 'path.*.with.wildcards')` - Extract multiple values using
wildcards (see below)

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L149"
target="_blank" style="float:right; font-size:smaller">source</a>

### has_path

>  has_path (o, *path:Any)

*Return `True` if nested `path` exists.*

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L145"
target="_blank" style="float:right; font-size:smaller">source</a>

### has_key

>  has_key (o, attr:str, sep='.')

*Return `True` if nested dot-separated `attr` exists.*

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L131"
target="_blank" style="float:right; font-size:smaller">source</a>

### val_atpath

>  val_atpath (o, *path:Any, default:Any=empty)

*Traverse nested `o` looking for attributes/items specified in `path`.*

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L118"
target="_blank" style="float:right; font-size:smaller">source</a>

### val_at

>  val_at (o, attr:str, default:Any=empty, sep='.')

*Traverse nested `o` looking for attributes/items specified in
dot-separated `attr`.*

``` python
# Basic usage: access nested data with dot notation
data = {'user': {'name': 'Alice', 'scores': [10, 20, 30]}}
test_eq(val_at(data, 'user.name'), 'Alice')
test_eq(val_at(data, 'user.scores.1'), 20)  # list index

# Safe default instead of exception
test_eq(val_at(data, 'user.age', default=25), 25)
```

``` python
# Works with lists of dicts (common in API responses)
records = [
    {'id': 1, 'items': [2, 3], 'meta': {'count': 4}}, 
    {'id': 5, 'items': [6, 7], 'nested': [{'val': 81}, {'val': 82}]}, 
    {'id': 9, 'items': [10, 11], 'meta': {'count': 12}}
]

test_eq(val_at(records, '0.id'), 1)
test_eq(val_at(records, '1.items'), [6, 7])
test_eq(val_at(records, '2.meta'), {'count': 12})
```

``` python
# Error handling: raises when path not found (unless default provided)
test_fail(lambda: val_at({}, 'a.b'))
test_fail(lambda: val_at([], 'a.b'))
test_fail(lambda: val_at({'a': 1}, 'a.b'))
test_fail(lambda: val_atpath({'a': 1}, 'a', 'b'))

# With default, no error
test_eq(val_at({'a': 1}, 'a.b', None), None)
```

``` python
j2 = {
    "app": {
        "Garden": {
            "Flowers": {
                "Red flower": "Rose",
                "White Flower": "Jasmine",
                "Yellow Flower": "Marigold"
            }
        },
        "Fruits": {
            "Yellow fruit": ["Mango", {"Banana": ["Canary Island", "Puerto Rico"]}],
            "Green fruit": "Guava",
            "White Flower": "groovy"
        },
        "Trees": {
            "label": {
                "Yellow fruit": "Pumpkin",
                "White Flower": "Bogan"
            }
        },
        "Numbers": [1, 2, 3, 4, 5],
        "Boolean": True,
        "Null": None
    }
}

j2_str = j2#json.dumps(j2)

test_eq(val_at(j2_str, 'app.Fruits.Yellow fruit.1.Banana.0'), 'Canary Island')
test_eq(val_at(j2_str, 'app.Garden.Flowers.Red flower'), 'Rose')
test_eq(val_at(j2_str, 'app.Numbers.2'), 3)
test_eq(val_at(j2_str, 'app.Boolean'), True)
test_eq(val_at(j2_str, 'app.Null'), None)
test_fail(lambda: val_at(j2_str, 'app.NonExistent'))
test_fail(lambda: val_at(j2_str, 'app.Fruits.Yellow fruit.3'))
test_is(val_at(j2_str, 'app.Fruits.Yellow fruit.3', None), None)
```

``` python
test_eq(has_key(j2_str, 'app.Garden.Flowers.Red flower'), True)
test_eq(has_key(j2_str, 'app.Numbers.2'), True)
test_eq(has_key(j2_str, 'app.Fruits.Yellow fruit.1.Banana.0'), True)
test_eq(has_key(j2_str, 'app.NonExistent'), False)
test_eq(has_key(j2_str, 'app.Fruits.Yellow fruit.3'), False)
```

``` python
test_fail(lambda:val_at(None, '0'))
test_eq(val_at(None, '0', None), None)
test_fail(lambda:val_atpath(None, 2))
test_eq(val_atpath(None, 2, default=None), None)
test_fail(lambda:val_atpath(None, -1))
test_eq(val_atpath(None, -1, default=None), None)
test_fail(lambda:val_at(None, '0.1'))
test_eq(val_at(None, '0.1', None), None)
test_fail(lambda:val_atpath(None, 4, 'b'))
test_eq(val_atpath(None, 4, 'b', default=None), None)

test_fail(lambda:val_atpath([], 1))
test_eq(val_atpath([], 1, default=None), None)
test_fail(lambda:val_atpath([], 'a', 2))
test_eq(val_atpath([], ('a', 2), default=None), None)

test_fail(lambda:val_atpath({}, 1))
test_eq(val_atpath({}, 1, default=None), None)
test_fail(lambda:val_atpath(object(), '2'))
test_eq(val_at(object(), '0', None), None)
test_fail(lambda:val_at(object(), 'a.1'))
test_eq(val_at(object(), 'a.1', None), None)
```

``` python
o = [1, 2, 3, [4, 5, 6], 7]
test_eq(val_at(o, '0'), 1)
test_eq(val_at(o, '-1'), 7)
test_eq(val_atpath(o, -1), 7)
test_eq(val_atpath(o, 2), 3)
test_eq(val_atpath(o, 3, 2), 6)
test_eq(val_atpath(o, 5, default=None), None)
test_eq(val_at(o, '3.4', None), None)

o = dict(a=1, b=2, c=3, d=dict(e=4, f=5), g=6)
test_eq(val_atpath(o, 'b'), 2)
test_eq(val_atpath(o, 'd', 'f'), 5)
test_eq(val_at(o, 'd.f'), 5)
test_eq(val_at(o, 'd.g', None), None)

(s := json.dumps(['foo', (1,2,3), {'bar': ('baz', None, 1.0, 2)}]))
o = json.loads(s)
test_eq(val_at(o, '0'), 'foo')
test_eq(val_atpath(o, 0), 'foo')
test_eq(val_at(o, '2.bar'), ['baz', None, 1.0, 2])
test_eq(val_atpath(o, 2, 'bar'), ['baz', None, 1.0, 2])
test_eq(val_at(o, '2.bar.3'), 2)
test_eq(val_at(o, '3.bar', None), None)
test_eq(val_atpath(o, 2, 'foo', default=None), None)

@dataclasses.dataclass
class _D:
    a: int
    b: str
    c: float
    d: dict[str, Any]
_d = _D(1, '2', 3.0, {'e': 4, 'f': '5', 'g': 6.0})

o = [0, 1, _d, 'a']
test_eq(val_atpath(o, 1), 1)
test_eq(val_at(o, '3'), 'a')
test_eq(val_atpath(o, 2), _d)
test_eq(val_at(o, '2.c'), 3.0)
test_eq(val_at(o, '2.d.f'), '5')
```

## vals_at, vals_atpath

Lookup **multiple** values using wildcards in paths. Think of it as a
lightweight JSONPath for common cases.

**When to use:** Extract values from all items in a collection without
explicit loops.

``` python
data = [
    {'user': {'name': 'Alice', 'age': 30}},
    {'user': {'name': 'Bob', 'age': 25}},
]
vals_at(data, '*.user.name')  # ('Alice', 'Bob')
```

**Related utilities:** -
[`val_at`](https://civvic.github.io/pote/basic.html#val_at) /
[`val_atpath`](https://civvic.github.io/pote/basic.html#val_atpath) -
Single value extraction (see above) - `filter_empty=True` parameter -
Remove `empty` sentinels from results for cleaner output

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L186"
target="_blank" style="float:right; font-size:smaller">source</a>

### vals_at

>  vals_at (o, path:str, filter_empty=False)

*Return nested values– or empty|(empty, …)– at `path` with wildcards ’*’
from `o`.\*

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L168"
target="_blank" style="float:right; font-size:smaller">source</a>

### vals_atpath

>  vals_atpath (o, *path:Any, filter_empty=False)

*Return nested values– or empty|(empty, …)– at `path` with wildcards ’*’
from `d`.\*

``` python
test_eq(vals_atpath(object, ''), ())
test_eq(vals_atpath(object, 'a'), ())
test_eq(vals_atpath(object, '*', 'a'), ())
test_eq(vals_atpath(object, '*', 'a', '*'), ())

test_eq(vals_atpath(['a', 'b'], 'a'), ())
test_eq(vals_atpath(['a', 'b'], '*'), ('a', 'b'))
test_eq(vals_atpath(['a', 'b'], '*', 'a'), ())

test_eq(vals_atpath(['a', 'b'], 0), ('a',))
test_eq(vals_atpath(['a', 'b'], 2), ())

test_eq(vals_atpath([{'a':1}], 'a'), ())
test_eq(vals_atpath([{'a':1}], '*'), [{'a':1}])
test_eq(vals_atpath([{'a':1}, {'a':2}], '*', 'a'), (1, 2))
```

``` python
test_eq(vals_at(object, ''), ())
test_eq(vals_at(object, 'a'), ())
test_eq(vals_at(object, '*.a'), ())
test_eq(vals_at(object, '*.a.*'), ())

test_eq(vals_at(['a', 'b'], 'a'), ())
test_eq(vals_at(['a', 'b'], '*'), ('a', 'b'))
test_eq(vals_at(['a', 'b'], '*.a'), ())

test_eq(vals_at(['a', 'b'], '0'), ('a',))
test_eq(vals_at(['a', 'b'], '2'), ())

test_eq(vals_at([{'a':1}], 'a'), ())
test_eq(vals_at([{'a':1}], '*'), [{'a':1}])
test_eq(vals_at([{'a':1}, {'a':2}], '*.a'), (1, 2))
```

``` python
d = [
    {'a': 1, 'b': [2,  3],  'c': {'d':   4}}, 
    {'a': 5, 'b': [6,  7],                  'd': [{'e': 81}, {'e': 82}]}, 
    {'a': 9, 'b': [10, 11], 'c': {'d': 12}}
]

test_eq(vals_atpath(d, ''), ())
test_eq(vals_atpath(d, object), ())  # type: ignore
test_eq(vals_atpath(d, '*'), (*d,))
test_eq(vals_atpath(d, '2'), (d[2],))
test_eq(vals_atpath(d, 'a'), ())
test_eq(vals_atpath([], '*', 'a'), ())#())
test_eq(vals_atpath([{'a': object}], '*', 'a', '*', 'b'), ())

test_eq(vals_atpath(d, '*', 'a'), (1, 5, 9))
test_eq(vals_atpath(d, '*', 'a', '*'), (1,5,9))
test_eq(vals_atpath(d, '*', 'b', 1), (3, 7, 11))
test_eq(vals_atpath(d, '*', 'c', 'd'), (4, empty, 12))
test_eq(vals_atpath(d, '*', 'c', 'd', filter_empty=True), (4, 12))

test_eq(vals_atpath(d, '*', 'd', '*', 'e'), (empty, (81, 82), empty))
test_eq(vals_atpath(d, '*', 'd', '*', 'e', filter_empty=True), ((81, 82),))
test_eq(vals_atpath(d, '*', 'd', '*', 'f'), ())
test_eq(vals_atpath(d, 1, 'd', '*', 'e'), (81, 82))
```

``` python
d = [
    {'a': 1, 'b': [2,  3],  'c': {'d':   4}}, 
    {'a': 5, 'b': [6,  7],                  'd': [{'e': 81}, {'e': 82}]}, 
    {'a': 9, 'b': [10, 11], 'c': {'d': 12}}
]

test_eq(vals_at(d, ''), ())
test_fail(lambda: vals_at(d, object))  # type: ignore
test_eq(vals_at(d, '*'), (*d,))
test_eq(vals_at(d, '2'), (d[2],))
test_eq(vals_at(d, 'a'), ())
test_eq(vals_at([], '*.a'), ())#())
test_eq(vals_at([{'a': object}], '*.a.*.b'), ())

test_eq(vals_at(d, '*,a'), ())
test_eq(vals_at(d, '*.a'), (1, 5, 9))
test_eq(vals_at(d, '*.a.*'), (1,5,9))
test_eq(vals_at(d, '*.b.1'), (3, 7, 11))
test_eq(vals_at(d, '*.c.d'), (4, empty, 12))
test_eq(vals_at(d, '*.c.d', filter_empty=True), (4, 12))

test_eq(vals_at(d, '*.d.*.e'), (empty, (81, 82), empty))
test_eq(vals_at(d, '*.d.*.e', filter_empty=True), ((81, 82),))
test_eq(vals_at(d, '*.d.*.f'), ())
test_eq(vals_at(d, '1.d.*.e'), (81, 82))
```

## deep_in

Check if a value exists anywhere in a nested structure (recursively
searches dicts and iterables).

``` python
def deep_in(o:Mapping|Iterable, val):
    "return True if val is in nested collections"
    if isinstance(o, Mapping):
        return val in o.values() or any(deep_in(v, val) for v in o.values() if isinstance(v, (Mapping, Iterable)))
    elif isinstance(o, Iterable):
        return val in o or any(deep_in(v, val) for v in o if isinstance(v, (Mapping, Iterable)))
    raise ValueError(f"deep_in: o must be a Mapping or Iterable, got {type(o)}")
```

``` python
test_fail(lambda:deep_in(None, 1))  # type: ignore
test_eq(deep_in((), 1), False)
test_eq(deep_in((1,), 1), True)
test_eq(deep_in((1,), 2), False)
test_eq(deep_in({'a': 1}, 1), True)
test_eq(deep_in({'a': 1}, 2), False)
test_eq(deep_in({'a': (1,)}, 1), True)
test_eq(deep_in({'a': (1,)}, 2), False)
test_eq(deep_in({'a': {'b': 1}}, 1), True)
test_eq(deep_in({'a': {'b': 1}}, 2), False)
test_eq(deep_in({'a': {'b': (1,)}}, 1), True)
test_eq(deep_in({'a': {'b': (1,)}}, 2), False)
```

``` python
def deep_in_v1(o:Mapping|Iterable, val):
    "return True if val is in o"
    if isinstance(o, Mapping):
        for v in o.values():
            if v == val or (is_listy(v) and deep_in_v1(v, val)): return True
        return False
    elif isinstance(o, Iterable):
        if val in o: return True
        return any(deep_in_v1(v, val) for v in o if is_listy(v))
    raise ValueError(f"deep_in: o must be a Mapping or Iterable, got {type(o)}")
```

``` python
def deep_in_v2(o:Mapping|Iterable, val):
    stack = deque([o])
    while stack:
        curr = stack.popleft()
        if isinstance(curr, Mapping):
            if val in curr.values(): return True
            stack.extend(v for v in curr.values() if is_listy(v))
        elif isinstance(curr, Iterable):
            if val in curr: return True  
            stack.extend(v for v in curr if is_listy(v))
        else:
            raise ValueError(f"deep_in: o must be a Mapping or Iterable, got {type(curr)}")
    return False
```

``` python
def deep_in_v3(o:Mapping|Iterable, val):
    def _search(obj):
        if isinstance(obj, Mapping):
            yield from obj.values()
            for v in obj.values():
                if is_listy(v): yield from _search(v)
        elif isinstance(obj, Iterable):
            yield from obj
            for v in obj:
                if is_listy(v): yield from _search(v)
        else:
            raise ValueError(f"deep_in: o must be a Mapping or Iterable, got {type(obj)}")
    
    return val in _search(o)
```

``` python
test_data = [
    ((), 1), ((1,), 1), ((1,), 2), ({'a': 1}, 1), ({'a': 1}, 2),  
    ({'a': (1,)}, 1), ({'a': (1,)}, 2), ({'a': {'b': 1}}, 1), 
    ({'a': {'b': 1}}, 2), ({'a': {'b': (1,)}}, 1), ({'a': {'b': (1,)}}, 2)
]

for o, val in test_data:
    orig = deep_in(o, val)
    test_eq(deep_in_v1(o, val), orig)
    test_eq(deep_in_v2(o, val), orig) 
    test_eq(deep_in_v3(o, val), orig)
```

### Performance exploration

The following cells test alternative implementations of
[`deep_in`](https://civvic.github.io/pote/basic.html#deep_in) to find
the best balance between clarity and speed. The chosen implementation
(exported above) uses recursive traversal with early termination.

``` python
deep_data = {'level1': {'level2': {'level3': {'level4': [1, 2, 3, {'deep': 'target'}]}}}}

def time_function(func, data, target, iterations=10000):
    start = time.time()
    for _ in range(iterations):
        func(data, target)
    return time.time() - start

print("\nPerformance comparison (10000 iterations):")
target = 'target'
times = {}
times['original'] = time_function(deep_in, deep_data, target)
times['v1_single_iter'] = time_function(deep_in_v1, deep_data, target)
times['v2_stack_based'] = time_function(deep_in_v2, deep_data, target)
times['v3_generator'] = time_function(deep_in_v3, deep_data, target)

for name, t in times.items():
    speedup = times['original'] / t if t > 0 else float('inf')
    print(f"{name:15}: {t:.4f}s (speedup: {speedup:.2f}x)")
```


    Performance comparison (10000 iterations):
    original       : 0.0813s (speedup: 1.00x)
    v1_single_iter : 0.0561s (speedup: 1.45x)
    v2_stack_based : 0.0665s (speedup: 1.22x)
    v3_generator   : 0.1373s (speedup: 0.59x)

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L194"
target="_blank" style="float:right; font-size:smaller">source</a>

### deep_in

>  deep_in (o:Union[Mapping,Iterable], val)

*return True if val is in nested collections*

# Dictionary Helpers

Utilities for common dictionary operations: bulk popping, getting
multiple keys, conditional updates.

## pops\_

Pop multiple keys from a dict into a new dict. Useful for extracting
specific kwargs or splitting a config dict.

**Related:**
[`pops_values_`](https://civvic.github.io/pote/basic.html#pops_values_)
returns a tuple of values instead of a dict;
[`gets`](https://civvic.github.io/pote/basic.html#gets) for
non-destructive retrieval.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L206"
target="_blank" style="float:right; font-size:smaller">source</a>

### pops\_

>  pops_ (d:dict, *ks:Hashable)

*Pop existing `ks` items from `d` in-place into a dictionary.*

``` python
# Usage: extract specific keys from a dict
d = {'a': 1, 'b': 2, 'c': 3}
extracted = pops_(d, 'a', 'b')
test_eq(extracted, {'a': 1, 'b': 2})
test_eq(d, {'c': 3})  # original dict modified
```

``` python
# Coverage: missing keys, empty dict, duplicates
test_eq(pops_({'a': 1, 'b': 2, 'c': 3}, 'd'), {})  # missing keys ignored
test_eq(pops_({'a': 1, 'b': 2, 'c': 3}, 'a', 'c', 'd'), {'a': 1, 'c': 3})  # some missing
test_eq(pops_({}, 'a'), {})  # empty dict
test_eq(pops_({'a': 1}, 'a', 'a'), {'a': 1})  # duplicate keys
```

## pops_values\_

Like [`pops_`](https://civvic.github.io/pote/basic.html#pops_) but
returns a tuple of values instead of a dict. Missing keys get
`Parameter.empty` as placeholder. Useful for unpacking:
`a, b, c = pops_values_(d, 'a', 'b', 'c')`

**Related:** [`pops_`](https://civvic.github.io/pote/basic.html#pops_)
returns a dict; [`gets`](https://civvic.github.io/pote/basic.html#gets)
for non-destructive retrieval.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L211"
target="_blank" style="float:right; font-size:smaller">source</a>

### pops_values\_

>  pops_values_ (d:dict, *ks:Hashable)

*Pop existing `ks` items from `d` in-place into a tuple of values or
`Parameter.empty` for missing keys.*

``` python
test_eq(pops_values_({'a': 1, 'b': 2, 'c': 3}, 'a', 'b'), (1, 2))
test_eq(pops_values_({'a': 1, 'b': 2, 'c': 3}, 'd'), (Parameter.empty,))
test_eq(pops_values_({'a': 1, 'b': 2, 'c': 3}, 'a', 'c', 'd'), (1, 3, Parameter.empty))
test_eq(pops_values_({}, 'a'), (Parameter.empty,))
test_eq(pops_values_({'a': 1}, 'a', 'a'), (1, Parameter.empty))
```

## gets

Fetch multiple values from a dict as a tuple. Missing keys return
`Parameter.empty`. Useful for unpacking multiple config values at once.

**Related:** [`pops_`](https://civvic.github.io/pote/basic.html#pops_) /
[`pops_values_`](https://civvic.github.io/pote/basic.html#pops_values_)
for destructive (modifying) retrieval.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L216"
target="_blank" style="float:right; font-size:smaller">source</a>

### gets

>  gets (d:Mapping, *ks:Hashable)

*Fetches `ks` values, or `Parameter.empty` for missing keys, from `d`
into a tuple.*

``` python
# Usage: unpack multiple config values at once
config = {'host': 'localhost', 'port': 8080, 'debug': True}
host, port = gets(config, 'host', 'port')
test_eq((host, port), ('localhost', 8080))

# Missing keys return Parameter.empty
test_eq(gets({'a': 1, 'b': 2}, 'a', 'c', 'b'), (1, Parameter.empty, 2))
```

``` python
# Coverage: empty args, Path keys, reordering
test_eq(gets({'a': 1, 'b': 2}), ())  # no keys requested
a, b = gets({'a': 1, 'b': 2}, 'b', 'a')  # reordered
test_eq((a, b), (2, 1))

d = {Path('a'): 1, Path('b'): 2}  # non-string keys
test_eq(gets(d, Path('a'), Path('c'), Path('b')), (1, Parameter.empty, 2))
```

## update\_

Update dict/object with kwargs, skipping values equal to `empty_value`.
Useful for conditional updates where you don’t want to set `None` or
other sentinel values.

``` python
# def update_(d:dict|None=None, /, empty_value=None, **kwargs):
#     "Update `d` in-place with `kwargs` whose values aren't `empty_value`"
#     d = d if d is not None else {}
#     for k, v in kwargs.items():
#         if v is not empty_value: d[k] = v
#     return d
```

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L221"
target="_blank" style="float:right; font-size:smaller">source</a>

### update\_

>  update_ (dest=None, empty_value=None, **kwargs)

*Update `dest` in-place with `kwargs` whose values aren’t `empty_value`*

Helper for conditionally updating dictionaries/namespaces.

``` python
# Usage: conditionally update dict (skip None by default)
d = {'a': 1}
update_(d, b=2, c=None)
test_eq(d, {'a': 1, 'b': 2})  # c=None was skipped

# Custom empty_value sentinel
d = {}
update_(d, a=True, b=Parameter.empty, empty_value=Parameter.empty)
test_eq(d, {'a': True})  # b was skipped
```

``` python
# Works with objects too (uses setattr)
class Config: host = 'localhost'; port = 8000
cfg = update_(Config(), host='0.0.0.0', timeout=None)
test_eq(cfg.host, '0.0.0.0')
test_eq(cfg.port, 8000)  # unchanged
test_is(hasattr(cfg, 'timeout'), False)  # None was skipped
```

``` python
# Coverage: create new dict, AD dict
d = update_(a=1, b=None)  # dest=None creates new dict
test_eq(d, {'a': 1})

ad = AD(a=1, b=2)
update_(ad, a=3, b=4, c=5)
test_eq(ad.a, 3)
test_eq(ad.c, 5)
```

``` python
ad = AD(a=1, b=2)
update_(ad, a=3, b=4, c=5)
test_eq(ad.a, 3)
test_eq(ad.b, 4)
test_eq(ad.c, 5)
```

# \_get_globals

Internal utility for accessing the caller’s global namespace. This
enables functions to dynamically resolve names from the calling module’s
context, useful for metaprogramming and dynamic imports.

**Note:** This is an internal helper (marked `#| exporti`). Most users
won’t need it directly.

``` python
def _gtest(): return _get_globals(__name__)
g1 = _gtest()
g2 = globals()
test_eq(g1, g2)
```

# Path Utilities

## bundle_path

Get the directory containing a module. Useful for finding resources
bundled with your package.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L237"
target="_blank" style="float:right; font-size:smaller">source</a>

### bundle_path

>  bundle_path (mod:str|module)

*Return the path to the module’s directory or current directory.*

``` python
import pote
```

``` python
test_eq(bundle_path(__name__), Path('.'))
test_eq(bundle_path('pote').resolve(), Path(pote.__file__).parent)
```

# ID Generation

Utilities for generating unique identifiers in the current session.

## Kounter

A callable counter that increments and returns the count for each key.
Useful for generating sequential IDs grouped by type.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L243"
target="_blank" style="float:right; font-size:smaller">source</a>

### Kounter

>  Kounter ()

*Initialize self. See help(type(self)) for accurate signature.*

``` python
kounter = Kounter()
cntr = Kounter()
cntr('a')
cntr('b')
cntr('a')
cntr('a')
cntr('b')
cntr('b')
cntr('b')
test_eq(cntr.d, {'a': 3, 'b': 4})
test_eq(cntr('int'), 1)
```

## id_gen

Create a function that generates unique IDs for objects. Without
arguments returns a random ID, with an object returns `TypeName_N` where
N increments per type.

``` python
lines = Path("static/wordlist.txt").read_text().splitlines()
words = [line.strip() for line in lines if line.isalpha()]
```

``` python
def modify_word(word):
    # Randomly capitalize the first or second letter
    if len(word) > 1:
        idx_to_capitalize = random.choice([0, 1])
        word = word[:idx_to_capitalize] + word[idx_to_capitalize].upper() + word[idx_to_capitalize + 1:]
    else:
        word = word.upper()  # If single letter, capitalize it
    
    # Randomly add a number (0–99) at the start or end
    if random.choice([True, False]):
        number = random.randint(0, 99)
        # if random.choice([True, False]):
        #     word = f"{number}{word}"  # Number at the start
        # else:
        word = f"{word}{number}"  # Number at the end
    
    return word

def generate_readable_id(num_words=3):
    words_part = [modify_word(random.choice(words)) for _ in range(num_words)]
    id_candidate = '-'.join(words_part)

    # Ensure it's a valid CSS identifier
    if not re.match(r"^[a-zA-Z_][\w\-]*$", id_candidate):  # Add '_' if invalid
        id_candidate = f"_{id_candidate}"
    
    return f"{id_candidate}-{random.randint(0, 9999)}"
```

``` python
generate_readable_id(), generate_readable_id()
```

    ('Stones65-Reproduce-sUpported-5570', 'Ball48-rEmove49-Knock-5723')

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L251"
target="_blank" style="float:right; font-size:smaller">source</a>

### id_gen

>  id_gen ()

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L248"
target="_blank" style="float:right; font-size:smaller">source</a>

### simple_id

>  simple_id ()

The [`id_gen`](https://civvic.github.io/pote/basic.html#id_gen) function
creates a function that takes any object and generates an unique Id
valid during the current session. Useful for creating unique element IDs
in dynamic HTML content.

``` python
new_id = id_gen()
new_id(), new_id()
```

    ('b1825ecee-64c1b6e4-347cdfc3-dec4c849',
     'b3b6ad721-cc6e6b28-072c20d6-8a34703d')

``` python
int_id = id_gen()
int_id(7), int_id(8)
```

    ('int_1', 'int_2')

``` python
obj_id = id_gen()
o1, o2 = object(), object()
print(obj_id(o1), obj_id(o2))

dict_id = id_gen()
print(dict_id(d1 := {'a': 1}), dict_id(d2 := {'a': 1}))

pth_id = id_gen()
print(pth_id(Path('.')), pth_id(Path()), pth_id(Path('./bin')))
```

    object_1 object_2
    dict_1 dict_2
    PosixPath_1 PosixPath_2 PosixPath_3

# Metaclasses

## WithCounterMeta

A metaclass that adds automatic instance counting. Each instance gets a
`_cnt_` attribute with its creation order number.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/basic.py#L260"
target="_blank" style="float:right; font-size:smaller">source</a>

### WithCounterMeta

>  WithCounterMeta (name, bases, dict)

*Adds a `_cnt_` attribute to its classes and increments it for each new
instance.*

``` python
class _T1(metaclass=WithCounterMeta): pass
class _T2(metaclass=WithCounterMeta): pass

test_is(_T1._cnt_, 0)
test_is(_T2._cnt_, 0)

test_is(_T1()._cnt_, 0)
test_is(_T1._cnt_, 1)
test_is(_T2._cnt_, 0)

test_is(_T1()._cnt_, 1)
test_is(_T2()._cnt_, 0)
test_eq(_T1._cnt_, 2)
test_eq(_T2._cnt_, 1)
```

------------------------------------------------------------------------
</doc><doc title="Test helpers" desc="Testing helpers that extend fastcore's test functions"># Test helpers



<table style="width:7%;">
<colgroup>
<col style="width: 6%" />
</colgroup>
<tbody>
<tr>
<td><!-- # Prologue --></td>
</tr>
</tbody>
</table>

# test_raises

Context manager for testing exceptions. More ergonomic than `test_fail`
for multi-line code blocks and allows optional message content
validation.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/test.py#L19"
target="_blank" style="float:right; font-size:smaller">source</a>

### test_raises

>  test_raises (expected:Type[Exception], contains:str|None=None)

``` python
with test_raises(ZeroDivisionError):
    1/0  # type: ignore

with test_raises(ZeroDivisionError, 'division by zero'):
    1/0  # type: ignore
```

# test_afail

Async version of
[`fastcore.test.test_fail`](https://fastcore.fast.ai/test.html#test_fail).
Test that an async function raises an exception.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/test.py#L32"
target="_blank" style="float:right; font-size:smaller">source</a>

### test_afail

>  test_afail (f, msg='', contains='', args=None, kwargs=None)

Like fastcore own ‘test_fail’, but async

# test_is_not

Test that two objects are not the same instance. Complement to
[`fastcore.test.test_is`](https://fastcore.fast.ai/test.html#test_is).

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/test.py#L43"
target="_blank" style="float:right; font-size:smaller">source</a>

### test_is_not

>  test_is_not (a, b)

*`test` that `a is not b`*

## <!-- # Colophon --></doc><doc title="Project setup" desc="Project setup utilities and Rich console configuration"># Project




# console

## Theme Customization

[`setup_console`](https://civvic.github.io/pote/project.html#setup_console)
supports theme customization through:

1.  **String theme name**: Loads from `rich_theme_manager` if installed
2.  **Theme object**: Pass a `rich.theme.Theme` instance directly
3.  **None**: Uses default Rich theme

**Example with theme manager:**

``` python
# Requires: pip install rich-theme-manager
console, cprint = setup_console(width=120, theme='monokai')
```

**Example with custom theme:**

``` python
from rich.theme import Theme

custom_theme = Theme({
    "info": "cyan",
    "warning": "yellow",
    "error": "bold red"
})
console, cprint = setup_console(theme=custom_theme)
```

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/project.py#L43"
target="_blank" style="float:right; font-size:smaller">source</a>

### setup_console

>  setup_console (width:int=140, theme:str|object|None=None, clear=False,
>                     rule=None)

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/project.py#L38"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_console

>  get_console ()

*Globally configured console*

``` python
print(_CONSOLE)
```

    <console width=140 ColorSystem.TRUECOLOR>

------------------------------------------------------------------------
</doc><doc title="Callback system" desc="Callback system for augmenting objects with side-effects"># Callback




------------------------------------------------------------------------

# Callback core

The callback pattern allows you to inject custom behavior at specific
points in an object’s lifecycle without modifying the object itself.
Think of callbacks as “hooks” where you can attach custom logic.

**Basic concept**: An object calls predefined method names (like
`before_fit`, `after_batch`) on its registered callbacks. Each callback
can implement whichever methods it needs and ignore the rest.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/callback.py#L39"
target="_blank" style="float:right; font-size:smaller">source</a>

### Callback

>  Callback ()

*Base class of callbacks.*

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/callback.py#L45"
target="_blank" style="float:right; font-size:smaller">source</a>

### run_cbs

>  run_cbs (cbs:Union[Iterable[__main__.Callback],fastcore.foundation.L],
>               method_nm:str, ctx=None, *args, **kwargs)

*Run `method_nm(ctx, ...)` of each callback in `cbs` in order.*

# Examples

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/callback.py#L53"
target="_blank" style="float:right; font-size:smaller">source</a>

### EchoCB

>  EchoCB ()

*Print the arguments.*

``` python
run_cbs((EchoCB(),), 'on_start', AD(count=3))
run_cbs((EchoCB(),), 'on_update', AD(count=3), 12)
```

    on_start ({'count': 3},) {}
    on_update ({'count': 3}, 12) {}

``` python
class VerboseCB(Callback):
    "Inspect the arguments."
    def before_fit(self, ctx): self.count = 0
    def after_batch(self, ctx): self.count += 1
    def after_fit(self, ctx): print(f'{ctx} Completed {self.count} batches')
```

``` python
cbs = [VerboseCB()]
run_cbs(cbs, 'before_fit')
test_eq(cbs[0].count, 0)
run_cbs(cbs, 'after_batch')
test_eq(cbs[0].count, 1)
test_stdout(lambda: run_cbs(cbs, 'after_fit'), 'None Completed 1 batches')
```

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/callback.py#L60"
target="_blank" style="float:right; font-size:smaller">source</a>

### FuncCB

>  FuncCB (**kwargs)

*Store functions that can be called as callbacks.*

``` python
cb = FuncCB(on_count=lambda ctx: print(ctx.count))
run_cbs((cb,), 'on_count', o := AD(count=3))
```

    3

``` python
def inc(ctx): ctx.count += 1

cb = FuncCB(on_count=(inc, lambda ctx: print(ctx.count)))
run_cbs((cb,), 'on_count', o := AD(count=3))
test_eq(o.count, 4)
```

    4

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/callback.py#L65"
target="_blank" style="float:right; font-size:smaller">source</a>

### PassCB

>  PassCB ()

*A callback that does nothing.*

# Helpers

## HasCallbacks

Mixin class that adds callback support to any class. It manages a list
of callbacks and provides methods to run them at specific lifecycle
points.

**Key features**: - Register callbacks via constructor or
[`with_cbs()`](https://civvic.github.io/pote/callback.html#with_cbs) -
Temporary callbacks via `this_cbs()` context manager - Automatic method
delegation for names in `cbs_names`

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/callback.py#L71"
target="_blank" style="float:right; font-size:smaller">source</a>

### HasCallbacks

>  HasCallbacks (*args, **kwargs)

*Base for classes that can be augmented with callbacks.*

``` python
class Test(HasCallbacks):
    count = 0
    cbs_names = ('on_think',)
    
    def think(self):
        self.callback('before_think')
        self.count += 1
        print('thinking...')
        self.on_think()
        self.callback('after_think')

    def act(self):
        self.callback('before_act')
        self.count = 1
        print('acting...')
        self.think()
        self.callback('after_act')


class VerboseCB(Callback):
    def before_act(self, ctx): print('before_act count:', ctx.count)
    def after_act(self, ctx): print('after_act count:', ctx.count)

test = Test()
test.act()
test_eq(test.count, 2)

print()
test = Test([VerboseCB()])
test.act()
test_eq(test.count, 2)
class ThinkCB(Callback):
    def on_think(self, ctx): ctx.count += 1

print()
test = Test([VerboseCB(), ThinkCB()])
test.act()
test_eq(test.count, 3)
```

    acting...
    thinking...

    before_act count: 0
    acting...
    thinking...
    after_act count: 2

    before_act count: 0
    acting...
    thinking...
    after_act count: 3

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/callback.py#L105"
target="_blank" style="float:right; font-size:smaller">source</a>

### with_cbs

>  with_cbs (nm:str|None=None)

*Decorator to add callbacks to a method.*

``` python
class Test(HasCallbacks):
    count = 0
    
    @with_cbs()
    def think(self):
        print('thinking...')
        self.count += 1

    @with_cbs('act')
    def act(self, cbs:Sequence[Callback]=()):
        with self.this_cbs(cbs):
            print('acting...')
            self.count = 1
            self.think()


class ActCB(Callback):
    def before_act(self, ctx): print('before_act count:', ctx.count)
    def after_act(self, ctx): 
        print('after_act count:', ctx.count)
        ctx.count += 1

class ThinkCB(Callback):
    def before_think(self, ctx): print('before_think count:', ctx.count)
    def after_think(self, ctx): 
        print('after_think count:', ctx.count)
        ctx.count += 1


test = Test()
test.act()
test_eq(test.count, 2)
print()

test = Test([ActCB()])
test.act()
test_eq(test.count, 3)
print()

test = Test([ActCB()])
test.act([ThinkCB()])
test_eq(test.count, 4)
```

    acting...
    thinking...

    before_act count: 0
    acting...
    thinking...
    after_act count: 2

    before_act count: 0
    acting...
    before_think count: 1
    thinking...
    after_think count: 2
    after_act count: 3

# Iteration

Infrastructure for tracking iteration progress. These helpers support
[`CollBack`](https://civvic.github.io/pote/callback.html#collback) by
determining iteration counts and monitoring state.

# CollBack

> Iterator wrapper with progress tracking and callbacks

[`CollBack`](https://civvic.github.io/pote/callback.html#collback) wraps
any iterable and provides:

1.  **Progress tracking**: Current position, total count, percentage,
    elapsed time
2.  **State access**: Query iteration state at any point
3.  **Callbacks**: Run custom code before/after/during iteration
4.  **Drop-in replacement**: Works anywhere an iterable is expected

## CollBack vs Standard Iteration

**Standard iteration**:

``` python
for item in items:
    process(item)  # No visibility into progress, timing, or position
```

**With CollBack**:

``` python
for item in CollBack(items, cbs=[LogProgressCB()]):
    process(item)  # Auto-logging of progress, timing, position
```

## Common Use Cases

- File processing — Track progress through large files
- Data pipelines — Monitor throughput and estimate completion time
- Training loops — Report epoch/batch progress with callbacks
- API calls — Rate limit, retry, log responses without cluttering
  business logic
- Testing — Inject behavior for debugging without modifying code

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/callback.py#L128"
target="_blank" style="float:right; font-size:smaller">source</a>

### CollBack

>  CollBack (source:Iterable[Any]=(),
>                total:Union[int,NoneType,Type[pote.basic.EmptyT]]=empty,
>                context:Any=empty, **kwargs)

*Track iterables and extend them with callbacks.*

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/callback.py#L194"
target="_blank" style="float:right; font-size:smaller">source</a>

### trackback

>  trackback (source:Iterable[Any],
>                 total:Union[int,NoneType,Type[pote.basic.EmptyT]]=empty,
>                 context:Any=empty, cbs:Sequence[__main__.Callback]=())

## Usage Examples

[`CollBack`](https://civvic.github.io/pote/callback.html#collback) is a
drop-in replacement for any iterable:

``` python
test_eq(deque([1,2,3], maxlen=3), deque(CollBack([1,2,3]), maxlen=3))
test_eq(list(ChainMap({'a':1}, {'b':2})), list(CollBack(ChainMap({'a':1}, {'b':2}))))  # Search multiple dicts
test_eq(list(CollBack(Counter('hello').items())), [('h', 1), ('e', 1), ('l', 2), ('o', 1)])
```

You can use
[`CollBack`](https://civvic.github.io/pote/callback.html#collback) to
track the progress of any iterable with arbitrary callbacks. It can be
used in place of the iterable in any function that takes an iterable.

``` python
tuple(CollBack(open('static/file.txt')))  # Line iterator
```

    ('line 1\n', 'line 2\n', 'line 3\n')

``` python
tuple(CollBack(open('static/file.txt').read(3)))  # Char iterator
```

    ('l', 'i', 'n')

``` python
tuple(CollBack(os.scandir()))  # Directory iterator
```

    (<DirEntry '10_callback.ipynb'>,
     <DirEntry '_quarto.yml'>,
     <DirEntry 'sidebar.yml'>,
     <DirEntry 'styles.css'>,
     <DirEntry '15_config.ipynb'>,
     <DirEntry 'nbdev.yml'>,
     <DirEntry '00_basic.ipynb'>,
     <DirEntry 'static'>,
     <DirEntry '05_test.ipynb'>,
     <DirEntry '.ipynb_checkpoints'>,
     <DirEntry '20_widgets.ipynb'>,
     <DirEntry '17_display.ipynb'>,
     <DirEntry '00_project.ipynb'>,
     <DirEntry 'index.ipynb'>)

``` python
def print_progress(ctx, line):
    if ctx.n % 100 == 0:
        print(f"Processed {ctx.n} {ctx.elapsed_time:.2f}")

def process_line(line): time.sleep(random.uniform(0.0001, 0.0005))

with open('10_callback.ipynb') as f:
    for st,line in trackback(f, cbs=[FuncCB(on_iter=print_progress)]):
        process_line(line)
```

    Processed 0 0.00
    Processed 100 0.04
    Processed 200 0.08
    Processed 300 0.12
    Processed 400 0.16
    Processed 500 0.20
    Processed 600 0.24
    Processed 700 0.28
    Processed 800 0.32
    Processed 900 0.36
    Processed 1000 0.40
    Processed 1100 0.44
    Processed 1200 0.48
    Processed 1300 0.52
    Processed 1400 0.56
    Processed 1500 0.60
    Processed 1600 0.64

## State Tracking and Validation

CollBack maintains iteration state and handles edge cases:

``` python
for o in trackback(range(3), cbs=[EchoCB()]): print(o)
```

    before_iter ({'n': None, 'total': 3, 'progress': None, 'elapsed_time': None},) {}
    ({'item': 0, 'n': 0, 'total': 3, 'progress': 0.3333, 'elapsed_time': None}, 0)
    on_iter ({'item': 0, 'n': 0, 'total': 3, 'progress': 0.3333, 'elapsed_time': 0.00010013580322265625}, 0) {}
    ({'item': 1, 'n': 1, 'total': 3, 'progress': 0.6667, 'elapsed_time': 0.00010013580322265625}, 1)
    on_iter ({'item': 1, 'n': 1, 'total': 3, 'progress': 0.6667, 'elapsed_time': 0.0001499652862548828}, 1) {}
    ({'item': 2, 'n': 2, 'total': 3, 'progress': 1.0, 'elapsed_time': 0.0001499652862548828}, 2)
    on_iter ({'item': 2, 'n': 2, 'total': 3, 'progress': 1.0, 'elapsed_time': 0.0001900196075439453}, 2) {}
    after_iter ({'n': 2, 'total': 3, 'progress': 1.0, 'elapsed_time': 0.0001900196075439453},) {}

``` python
t = CollBack(())
test_eq(t.total, 0)
with test_raises(StopIteration): next(iter(t))

for _ in (t := CollBack(range(3))):
    print(t.state)

t = CollBack(range(3))
test_eq(t.state, {'n': None, 'total': 3, 'progress': None, 'elapsed_time': None})
test_eq(next(it := iter(t)), 0)
test_eq(t.state, {'item': 0, 'n': 0, 'total': 3, 'progress': 0.3333, 'elapsed_time': t.elapsed_time})
test_eq(next(it), 1)
test_eq(t.state, {'item': 1, 'n': 1, 'total': 3, 'progress': 0.6667, 'elapsed_time': t.elapsed_time})
test_eq(next(it), 2)
test_eq(t.state, {'item': 2, 'n': 2, 'total': 3, 'progress': 1.0, 'elapsed_time': t.elapsed_time})
with test_raises(StopIteration): next(it)
test_eq(t.state, {'n': 2, 'total': 3, 'progress': 1.0, 'elapsed_time': t.elapsed_time})

t = CollBack('abcdef')
test_eq([o for o in t], list('abcdef'))
test_eq(t.state, {'n': 5, 'total': 6, 'progress': 1.0, 'elapsed_time': t.elapsed_time})
test_eq(t.active, False)

t = CollBack(repeat(1, 3))
test_eq(list(map(lambda x: x, t)), [1, 1, 1])
test_eq(t.state, {'n': 2, 'total': 3, 'progress': 1.0, 'elapsed_time': t.elapsed_time})
```

    {'item': 0, 'n': 0, 'total': 3, 'progress': 0.3333, 'elapsed_time': None}
    {'item': 1, 'n': 1, 'total': 3, 'progress': 0.6667, 'elapsed_time': 4.1961669921875e-05}
    {'item': 2, 'n': 2, 'total': 3, 'progress': 1.0, 'elapsed_time': 6.699562072753906e-05}

``` python
t = CollBack((12, 56, -1, 2, 67), 3)
test_eq([o for o in t], (12, 56, -1))
test_eq(t.state, {'n': 2, 'total': 3, 'progress': 1.0, 'elapsed_time': t.elapsed_time})
```

``` python
t = CollBack(c := (1, 2, -1, -2, 7))
test_eq(reduce(lambda x, y: x+y, t), 7)
test_eq(t.state, {'n': 4, 'total': 5, 'progress': 1.0, 'elapsed_time': t.elapsed_time})


class CountCB(Callback):
    def before_iter(self, ctx): self.count = 0
    def on_iter(self, ctx, _): self.count += 1

with (t := CollBack(c)).this_cbs([cb := CountCB()]):
    test_eq(reduce(lambda x, y: x+y, t), 7)
test_eq(t.state, {'n': 4, 'total': 5, 'progress': 1.0, 'elapsed_time': t.elapsed_time})
test_eq(cb.count, 5)

test_eq(reduce(lambda x, y: x+y, (t := CollBack(c, cbs=[cb]))), 7)
test_eq(t.state, {'n': 4, 'total': 5, 'progress': 1.0, 'elapsed_time': t.elapsed_time})
test_eq(cb.count, 5)
```

``` python
t = CollBack(repeat(7), 3)
oo = [o for o in t]
test_eq(oo, (7, 7, 7))
test_eq(t.state, {'n': 2, 'total': 3, 'progress': 1.0, 'elapsed_time': t.elapsed_time})

t = CollBack(repeat(None), None)
for _ in t:
    if t.state.n >= 10: break  # type: ignore
test_eq(t.state, {'n': 10, 'total': 11, 'progress': 1.0, 'elapsed_time': t.elapsed_time})

def fibonacci():
    a, b = 0, 1
    while True:
        yield a
        a, b = b, a + b

test_eq(CollBack(fibonacci(), 10), [0, 1, 1, 2, 3, 5, 8, 13, 21, 34])
```

``` python
t = CollBack(())
test_eq(t.total, 0)
with test_raises(StopIteration): next(iter(t))
for i in t: pass

t = CollBack(range(6))
test_eq(t.state, {'n': None, 'total': 6, 'progress': None, 'elapsed_time': None})
test_eq(next(iter(t)), 0)
test_eq(t.state, {'n': 0, 'total': 6, 'progress': 0.1667, 'elapsed_time': t.elapsed_time})

t = CollBack(range(6))
test_eq([t.n for i in t], range(6))
test_eq(t.state, {'n': 5, 'total': 6, 'progress': 1.0, 'elapsed_time': t.elapsed_time})
```

``` python
t = CollBack('abc', None)
test_eq([_ for _ in t], ('a', 'b', 'c'))
test_eq(t.state, {'n': 2, 'total': 3, 'progress': 1.0, 'elapsed_time': t.elapsed_time})
```

# process\_

Convenience function for batch processing iterables with filtering,
slicing, and callbacks.

**Why use
[`process_`](https://civvic.github.io/pote/callback.html#process_)?**

Instead of manually consuming an iterator just to trigger side effects:

``` python
for item in CollBack(items[1:10], cbs=[logger]):
    if predicate(item):
        pass  # Just consuming for side effects
```

Use [`process_`](https://civvic.github.io/pote/callback.html#process_)
for cleaner intent:

``` python
process_(items, logger, slice(1, 10), pred=predicate)
```

**Common patterns**: - Process a subset of data with progress tracking -
Apply callbacks without explicit loop - Filter and slice in one
expression - Collect callback results for inspection

https://stackoverflow.com/questions/50937966/fastest-most-pythonic-way-to-consume-an-iterator

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/callback.py#L201"
target="_blank" style="float:right; font-size:smaller">source</a>

### process\_

>  process_ (iterable:Iterable[~_T],
>                cbs:Union[__main__.Callback,Sequence[__main__.Callback]]=(),
>                slc:slice|None=None, pred:Optional[Callable[[~_T],bool]]=None,
>                context:Any=empty, **kwargs)

*Process a subset `slc` of `iterable` filtered by `pred` with callbacks
from `cbs` and
[`FuncCB`](https://civvic.github.io/pote/callback.html#funccb) `kwargs`*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>iterable</td>
<td>Iterable</td>
<td></td>
<td></td>
</tr>
<tr>
<td>cbs</td>
<td>Union</td>
<td>()</td>
<td></td>
</tr>
<tr>
<td>slc</td>
<td>slice | None</td>
<td>None</td>
<td></td>
</tr>
<tr>
<td>pred</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr>
<td>context</td>
<td>Any</td>
<td>EmptyT</td>
<td></td>
</tr>
<tr>
<td>kwargs</td>
<td>VAR_KEYWORD</td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>tuple</strong></td>
<td></td>
<td><strong>FuncCB kwargs</strong></td>
</tr>
</tbody>
</table>

### Usage Example

Process even numbers from positions 1-9:

``` python
process_(range(10), EchoCB(), slice(1,9), pred=lambda x: x%2==0);
```

    before_iter ({'n': None, 'total': 4, 'progress': None, 'elapsed_time': None},) {}
    on_iter ({'item': 2, 'n': 0, 'total': 4, 'progress': 0.25, 'elapsed_time': 5.1975250244140625e-05}, 2) {}
    on_iter ({'item': 4, 'n': 1, 'total': 4, 'progress': 0.5, 'elapsed_time': 7.772445678710938e-05}, 4) {}
    on_iter ({'item': 6, 'n': 2, 'total': 4, 'progress': 0.75, 'elapsed_time': 9.393692016601562e-05}, 6) {}
    on_iter ({'item': 8, 'n': 3, 'total': 4, 'progress': 1.0, 'elapsed_time': 0.0001087188720703125}, 8) {}
    after_iter ({'n': 3, 'total': 4, 'progress': 1.0, 'elapsed_time': 0.0001087188720703125},) {}

``` python
# Real-world pattern: process with inline callback functions
count = 0
def track_count(ctx, item): 
    global count
    count += 1

process_(range(20), slc=slice(5, 15), pred=lambda x: x % 3 == 0, on_iter=track_count)
test_eq(count, 3)  # 6, 9, 12
```

------------------------------------------------------------------------
</doc><doc title="Config data" desc="Configuration namespace with context manager support"># Config




------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/config.py#L19"
target="_blank" style="float:right; font-size:smaller">source</a>

### Config

>  Config ()

*Store of arbitrary values*

## Usage Examples

### With dataclass

``` python
@dataclasses.dataclass
class _Dc(Config):
    a: int = 1
    b: str = '2'
    c: dict = dataclasses.field(default_factory=lambda: {'c1': 1})

t = _Dc()
print(t)

test_eq(t.a, 1)
with t(a=3): test_eq(t.a, 3)
test_eq(t.a, 1)

t.update(a=3, d=10)
test_eq(t.a, 3)
test_is(hasattr(t, 'd'), False)

t
```

    _Dc(a=1, b='2', c={'c1': 1})

    _Dc(a=3, b='2', c={'c1': 1})

### With inheritance

Config supports inheritance for composing hierarchical configurations:

``` python
class _A(Config):
    a: int = 1
    b: str = '2'

class _B(_A):
    a: int = 7
    c: dict
    def __init__(self, *args, **kwargs): self.c = {'c1': 1}

b = _B()
print(b)

test_eq(b.a, 7)
with b(a=3): test_eq(b.a, 3)
test_eq(b.a, 7)

b.update(a=3, d=10)
test_eq(b.a, 3)
test_is(hasattr(b, 'd'), False)

b
```

    {'a': 7, 'c': {'c1': 1}, 'b': '2'}

    {'a': 3, 'c': {'c1': 1}, 'b': '2'}

------------------------------------------------------------------------


### Context manager patterns

``` python
# Temporary overrides for testing
class AppConfig(Config):
    debug: bool = False
    log_level: str = 'INFO'
    timeout: int = 30

cfg = AppConfig()

# Normal operation
test_eq(cfg.debug, False)

# Test with debug enabled
with cfg(debug=True, log_level='DEBUG'):
    test_eq(cfg.debug, True)
    test_eq(cfg.log_level, 'DEBUG')
    test_eq(cfg.timeout, 30)  # unchanged

# Reverted after context
test_eq(cfg.debug, False)
test_eq(cfg.log_level, 'INFO')
```</doc><doc title="Display helpers" desc="Jupyter display enhancements and Rich integration"># Display



This module enhances Jupyter’s display capabilities with:

- Rich rendering — Leverage `rich` library for beautiful object display
- Interactive JSON — Collapsible JSON viewer with configurable depth
- Dynamic CSS — Generate and update CSS stylesheets programmatically
- Global styles — Manage notebook-wide CSS that updates reactively

## Key Components

- [`pretty_repr`](https://civvic.github.io/pote/display.html#pretty_repr)
  — Render objects using `rich` formatting (HTML + text)
- [`rich_display`](https://civvic.github.io/pote/display.html#rich_display)
  — Display objects with rich formatting and updateable handles
- [`RenderJSON`](https://civvic.github.io/pote/display.html#renderjson)
  — Interactive collapsible JSON viewer
- [`cssmap`](https://civvic.github.io/pote/display.html#cssmap) —
  Convert Python dicts to CSS strings (including nested at-rules)
- [`GlobalCSS`](https://civvic.github.io/pote/display.html#globalcss) —
  Manage global CSS with reactive updates

## When to Use

- Pretty printing — Display complex data structures with syntax
  highlighting
- Data exploration — Inspect nested JSON/dicts with collapsible views
- Notebook styling — Generate CSS from Python for consistent theming
- Dynamic UIs — Update styles reactively based on state changes


# Rich display

Utilities for rendering objects with `rich` formatting in Jupyter. These
functions generate both HTML (for rich notebooks) and plain text (for
terminal/markdown) representations.

**Key features**: - Syntax highlighting for data structures -
Configurable output formats (HTML, text, or both) - Updateable display
handles for reactive UIs

``` python
from rich.json import JSON
from rich.jupyter import display as rich_display
```

``` python
def display_json(json):
    json_renderable = JSON.from_data(json)
    a = list(console.render(json_renderable))
    rich_display(a, console._render_buffer(a))
```

``` python
display_json({'a': 1, 'b': 2})
```

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span>
  <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">"a"</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>,
  <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">"b"</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>
<span style="font-weight: bold">}</span>
</pre>

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/display.py#L32"
target="_blank" style="float:right; font-size:smaller">source</a>

### pretty_repr

>  pretty_repr (*o, html:bool=True, text:bool=True, **kwargs)

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/display.py#L32"
target="_blank" style="float:right; font-size:smaller">source</a>

### pretty_repr

>  pretty_repr (*o, html:bool=True, text:bool=True, **kwargs)

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/display.py#L32"
target="_blank" style="float:right; font-size:smaller">source</a>

### pretty_repr

>  pretty_repr (*o, html:bool=True, text:bool=True, **kwargs)

``` python
display(HTML(pretty_repr({'a': 1, 'b': [1,2,3]}, text=False)))
print(pretty_repr({'a': 1, 'b': [1,2,3]}, html=False))
cprint({'a': 1, 'b': [1,2,3]})
```

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'a'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008000; text-decoration-color: #008000">'b'</span>: <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span><span style="font-weight: bold">]}</span>
</pre>

    {'a': 1, 'b': [1, 2, 3]}

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'a'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008000; text-decoration-color: #008000">'b'</span>: <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span><span style="font-weight: bold">]}</span>
</pre>

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/display.py#L41"
target="_blank" style="float:right; font-size:smaller">source</a>

### rich_display

>  rich_display (*o,
>                    dhdl:IPython.core.display_functions.DisplayHandle|None=None
>                    )

``` python
rich_display({'a': 1, 'b': 2}, [3, 4, 5])
```

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'a'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008000; text-decoration-color: #008000">'b'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">}</span>
</pre>
&#10;<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span><span style="font-weight: bold">]</span>
</pre>

``` python
dhdl = display(display_id=True)
rich_display({'a': 1, 'b': 2}, [3, 4, 5], dhdl=dhdl)
```

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'a'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008000; text-decoration-color: #008000">'b'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">}</span>
</pre>
&#10;<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span><span style="font-weight: bold">]</span>
</pre>

# Collapsible JSON

Interactive JSON viewer using
[renderjson](https://github.com/caldwell/renderjson). Displays JSON with
collapsible nodes, perfect for exploring deeply nested data.

**Features**: - Click to expand/collapse nodes - Configurable initial
expansion level - Scrollable container with max height - Automatic CDN
loading of renderjson library

**Use cases**: API responses, config files, deeply nested data
structures

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/display.py#L49"
target="_blank" style="float:right; font-size:smaller">source</a>

### RenderJSON

>  RenderJSON (json_data, max_height=200, init_level=0)

*Initialize self. See help(type(self)) for accurate signature.*

``` python
json_data = {
    "name": "Petronila",
    "age": 28,
    "interests": ["reading", "cycling", "technology"],
    "education": {
        "bachelor": "Computer Science",
        "master": "Data Science",
        "phd": "Not enrolled"
    }
}

RenderJSON(json_data, init_level=1).display()
```

<div id="wrapper-0cd15e48-1cd2-4f12-9234-61ea008bf587" style="width: 100%; max-height: 200px; overflow-y: auto;">
    <div id="0cd15e48-1cd2-4f12-9234-61ea008bf587" style="width: 100%;"></div>
    <script>
        function renderMyJson() {
            renderjson.set_show_to_level(1);
            document.getElementById('0cd15e48-1cd2-4f12-9234-61ea008bf587').appendChild(renderjson({"name": "Petronila", "age": 28, "interests": ["reading", "cycling", "technology"], "education": {"bachelor": "Computer Science", "master": "Data Science", "phd": "Not enrolled"}}));
        };
        function loadRenderjson() {
            if (window.renderjson) return Promise.resolve();
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/renderjson@latest/renderjson.js';
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        };
        loadRenderjson().then(renderMyJson).catch(err => console.error('Failed to load renderjson:', err));
    </script>
</div>

# CSS

Utilities for generating and managing CSS in notebooks. Write styles in
Python dicts instead of CSS strings for better maintainability and
dynamic generation.

## cssmap

Convert Python dictionaries to CSS strings. Supports: - Nested
selectors - At-rules (`@media`, `@scope`, `@keyframes`, etc.) - Proper
indentation and formatting

**Why use this?** - Type-safe CSS generation - Easier to compose and
reuse styles - Programmatic style generation (loops, conditionals)

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/display.py#L105"
target="_blank" style="float:right; font-size:smaller">source</a>

### cssmap

>  cssmap (stylesheet, lvl:int=0)

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/display.py#L105"
target="_blank" style="float:right; font-size:smaller">source</a>

### cssmap

>  cssmap (stylesheet, lvl:int=0)

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/display.py#L105"
target="_blank" style="float:right; font-size:smaller">source</a>

### cssmap

>  cssmap (stylesheet, lvl:int=0)

``` python
expected = '''@scope (div.tableFixHead) {
  :scope {
    overflow-y: auto;
    max-width: max-content
  }

  thead th {
    position: sticky;
    top: 0px;
    background-color: gray
  }
}

body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px
}'''
```

``` python
style = {
    '@scope (div.tableFixHead)': {
        ':scope': {
            'overflow-y': 'auto',
            'max-width': 'max-content',
        },
        'thead th': {
            'position': 'sticky',
            'top': '0px',
            'background-color': 'gray',
        }
    },
    'body': {
        'font-family': 'Arial, sans-serif',
        'margin': '0',
        'padding': '20px'
    }
}


css = cssmap(style)
test_eq(css, expected)
display(Markdown(f"```css\n{css}\n```"))
```

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="background-color: #272822">                                                                                                                   
 </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">@</span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">scope</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">(div</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">.</span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">tableFixHead</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">)</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> {</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">  :</span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">scope</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> {</span><span style="background-color: #272822">                                                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">overflow-y</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">auto</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">;</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">max-width</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: max-content</span><span style="background-color: #272822">                                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">  }</span><span style="background-color: #272822">                                                                                                               </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">  </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">thead</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">th</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> {</span><span style="background-color: #272822">                                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">position</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">sticky</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">;</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">top</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">px</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">;</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">background-color</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">gray</span><span style="background-color: #272822">                                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">  }</span><span style="background-color: #272822">                                                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">}</span><span style="background-color: #272822">                                                                                                                 </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">body</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> {</span><span style="background-color: #272822">                                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">  </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">font-family</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: Arial, </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">sans-serif</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">;</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">  </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">margin</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">;</span><span style="background-color: #272822">                                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">  </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">padding</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">20</span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">px</span><span style="background-color: #272822">                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">}</span><span style="background-color: #272822">                                                                                                                 </span>
<span style="background-color: #272822">                                                                                                                   
</span></pre>

## GlobalCSS

Manage notebook-wide CSS with reactive updates. Create a single
[`GlobalCSS`](https://civvic.github.io/pote/display.html#globalcss)
instance, display it once, then add/update styles dynamically throughout
your notebook.

**Pattern**:

``` python
# Cell 1: Initialize and display
GCSS = GlobalCSS()
display(GCSS)

# Cell 2: Add styles dynamically
GCSS.add('my-component', '.my-component { color: blue; }')

# Cell 3: Update existing styles
GCSS.update('my-component', '.my-component { color: red; }')
```

**Benefits**: - Single source of truth for notebook styles - No
duplicate `<style>` tags - Reactive updates without re-executing cells -
Named styles for easy management

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/display.py#L124"
target="_blank" style="float:right; font-size:smaller">source</a>

### GlobalCSS

>  GlobalCSS (css:dict[str,str]|None=None)

*Initialize self. See help(type(self)) for accurate signature.*

``` python
GCSS = GlobalCSS()
display(GCSS)
```

<style id="test">.__test__gcss__ { color: green; }</style>

``` python
<div class="__test__gcss__">Hello</div>
```

<div class="__test__gcss__">Hello</div>

``` python
GCSS.add('test', '.__test__gcss__ { color: red; }')
```

``` python
GCSS.update('test', '.__test__gcss__ { color: green; }')
```

``` python
test_stdout(lambda: display(GCSS), 'GlobalCSSs should be displayed only once, skipping.')
```

------------------------------------------------------------------------
</doc><doc title="Widgets tools" desc="ipywidgets utilities for async and blocking operations (requires pote[widgets])"># Widgets




# cleanupwidgets

> Helper to properly cleanup ipywidget instances by closing their comms.

When working with ipywidgets in notebooks, each widget creates a comm
channel with the kernel. During heavy development, it’s better to close
the widgets, to avoid memory leaks and kernel issues.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/widget.py#L28"
target="_blank" style="float:right; font-size:smaller">source</a>

### close_widget

>  close_widget (w:ipywidgets.widgets.widget.Widget, all:bool=True)

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/widget.py#L36"
target="_blank" style="float:right; font-size:smaller">source</a>

### cleanupwidgets

>  cleanupwidgets (*ws, mod:str|None=None, clear=True, all=True)

``` python
_b = W.Button()
test_eq(_b.comm is not None, True)
cleanupwidgets('_b')
test_is(_b.comm, None)
```

``` python
_b = W.Button()
test_eq(_b.comm is not None, True)
cleanupwidgets('_b')
test_is(_b.comm, None)
```

``` python
import ipywidgets.widgets.widget
import ipywidgets as W
from IPython.core.getipython import get_ipython
```

``` python
ipywidgets.widgets.widget._instances
```

    {}

``` python
def get_active_widget_comms():
    """Get "official" list of widget comms"""
    ip = get_ipython(); kernel = ip.kernel  # type: ignore
    if kernel:
        ks = W.Widget.get_manager_state()['state'].keys()
        for k,c in kernel.comm_manager.comms.items():
            if c.comm_id in ks:
                yield c
```

``` python
[*get_active_widget_comms()]
```

    []

``` python
W.Widget.close_all()
```

# Clickable

> `Button` subclass with a `value` trait.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/widget.py#L47"
target="_blank" style="float:right; font-size:smaller">source</a>

### Clickable

>  Clickable (description='', **kwargs)

*Button with value.*

``` python
cleanupwidgets('btn')
display(btn := Clickable())
```

    Clickable(value=0, description='0', style=ButtonStyle())

``` python
cleanupwidgets('box')
box = W.HBox([sld := W.IntSlider(), btn := Clickable('>', layout={'width':'30px'})])
btn.on_click(lambda _: sld.set_trait('value', sld.value + 10))
display(box)
```

    HBox(children=(IntSlider(value=0), Clickable(value=0, description='>', layout=Layout(width='30px'), style=Butt…

# Asynchronous Widgets

Two common patterns for non-blocking widget interactions:

1.  **Wait for user interaction**: Pause code execution without blocking
    the kernel
2.  **Update widgets in background**: Progress bars, live updates while
    kernel remains responsive

These patterns leverage Python’s async/await or generator-based
approaches.

*Note: Examples below adapted from ipywidgets documentation*

Two scenarios where we’d like widget-related code to run without
blocking the kernel from acting on other execution requests.

1.  Pausing code to wait for user interaction with a widget in the
    frontend
2.  Updating a widget in the background

``` python
cleanupwidgets('slider')

display(slider := W.IntSlider(max=10))

def work(slider):
    start = time.time()
    print(f"waiting for slider to reach {slider.max}...", end='')
    while True:
        print('.', end='')
        time.sleep(0.5)
        if (time.time() - start) > 5: print('timeout'); break

work(slider)
```

    IntSlider(value=0, max=10)

    waiting for slider to reach 10.............timeout

Try to change the slider. You can, the front-end is responsive, but the
kernel is blocked from running other code, including handling messages
from the front-end.

``` python
cleanupwidgets('progress')

display(progress := W.FloatProgress(value=0.0, min=0.0, max=1.0))

async def work(progress):
    total = 100
    for i in range(total):
        time.sleep(0.05)
        progress.value = float(i+1)/total

await work(progress)
```

    FloatProgress(value=0.0, max=1.0)

``` python
print(progress.value)
```

    1.0

Async doesn’t help, the kernel is still blocked.

### Waiting for user interaction

> Pausing code to wait for user interaction with a widget in the
> frontend

#### Event loop integration

If we take advantage of the event loop integration IPython offers, we
can have a nice solution async/await syntax.

We define a new function that returns a future for when a widget
attribute changes.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/widget.py#L57"
target="_blank" style="float:right; font-size:smaller">source</a>

### wait_for_change

>  wait_for_change (widget:ipywidgets.widgets.widget.Widget, value:str)

And we finally get to our function where we will wait for widget
changes. We’ll do 10 units of work, and pause after each one until we
observe a change in the widget. Notice that the widget’s value is
available to us, since it is what the
[`wait_for_change`](https://civvic.github.io/pote/widgets.html#wait_for_change)
future has as a result.

Run this function, and change the slider 10 times.

``` python
cleanupwidgets('slider1', 'out1')

slider1 = W.IntSlider()
out1 = W.Output()

async def f():
    for i in range(10):
        out1.append_stdout('did work ' + str(i))
        x = await wait_for_change(slider1, 'value')
        out1.append_stdout(' - async function continued with value ' + str(x) + '\n')
asyncio.ensure_future(f())

display(slider1, out1)
```

    IntSlider(value=0)

    Output()

Note that this is not blocking the kernel from running other code. We
can run other cells, or even other widgets.

``` python
cleanupwidgets('slider2', 'out2')

slider2 = W.IntSlider()
out2 = W.Output()

def test():
    async def f():
        for i in range(10):
            out2.append_stdout('did work ' + str(i))
            x = await wait_for_change(slider2, 'value')
            out2.append_stdout(' - async function continued with value ' + str(x) + '\n')
    asyncio.ensure_future(f())

test()
display(slider2, out2)
```

    IntSlider(value=0)

    Output()

#### Generator approach

> Updating a widget in the background

If you can’t take advantage of the async/await syntax, or you don’t want
to modify the event loop, you can also do this with generator functions.

First, we define a decorator which hooks a generator function up to
widget change events.

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/widget.py#L66"
target="_blank" style="float:right; font-size:smaller">source</a>

### yield_for_change

>  yield_for_change (widget, attribute)

\*Pause a generator to wait for a widget change event.

This is a decorator for a generator function which pauses the generator
on yield until the given widget attribute changes. The new value of the
attribute is sent to the generator and is the value of the yield.\*

Then we set up our generator.

``` python
cleanupwidgets('slider3')
display(slider3 := W.IntSlider())

@yield_for_change(slider3, 'value')
def f():
    for i in range(10):
        print('did work %s'%i, end=' ')
        x = yield
        print('- generator function continued with value %s'%x)
f();
```

    IntSlider(value=0)

    did work 0 

#### Modifications

The above two approaches both waited on widget change events, but can be
modified to wait for other things, such as button event messages (as in
a “Continue” button), etc.

``` python
cleanupwidgets('btn')

# class Clickable(W.Button):
#     clicked = T.Int(0)
#     def __init__(self, *args, on_click=None, **kwargs):
#         super().__init__(*args, **kwargs)
#         if on_click is None:
#             self.on_click(lambda b: b.set_trait('clicked', b.clicked + 1))
#             T.dlink((self, 'clicked'), (self, 'description'), lambda x: f'{x}')
#         else:
#             self.on_click(on_click)

display(btn := Clickable())

@yield_for_change(btn, 'value')
def f():
    for i in range(10):
        print('did work %s'%i, end=' '  )
        x = yield
        print('- generator function continued with value %s'%x)
f();
```

    Clickable(value=0, description='0', style=ButtonStyle())

    did work 0 

``` python
cleanupwidgets('btn2', 'out3')
out3 = W.Output()

display(btn2 := Clickable(), out3)

def f():
    async def f():
        for i in range(10):
            out3.append_stdout('did work ' + str(i))
            x = await wait_for_change(btn2, 'value')
            out3.append_stdout(' - async function continued with value ' + str(x) + '\n')
    asyncio.ensure_future(f())

f()
```

    Clickable(value=0, description='0', style=ButtonStyle())

    Output()

``` python
cleanupwidgets('txt', 'out4')
out4 = W.Output()

display(txt := W.Text(continuous_update=False), out4)

def f():
    async def f():
        while True:
            x = await wait_for_change(txt, 'value')
            out4.append_stdout(' - async function continued with value ' + str(x) + '\n')
            if x == 'exit': break
            txt.value = ''
    asyncio.ensure_future(f())

f()
```

    Text(value='', continuous_update=False)

    Output()

### Updating a widget in the background

Sometimes you’d like to update a widget in the background, allowing the
kernel to also process other execute requests. We can do this with
threads. In the example below, the progress bar will update in the
background and will allow the main kernel to do other computations.

``` python
cleanupwidgets('progress')

progress = W.FloatProgress(value=0.0, min=0.0, max=1.0)

def work(progress):
    total = 100
    for i in range(total):
        time.sleep(0.01)
        progress.value = float(i+1)/total

thread = threading.Thread(target=work, args=(progress,))
display(progress)
thread.start()
```

    FloatProgress(value=0.0, max=1.0)

``` python
print(progress.value)
```

    1.0

# Blocking widgets

Sometimes you need the opposite: **block** the kernel until the user
provides input. This is useful for:

- Sequential workflows where each cell depends on previous user input
- “Run All” notebooks that need user decisions
- Modal-like dialogs that pause execution

The challenge: `ipywidgets` is designed to be non-blocking. Simple
solutions don’t work because the kernel needs to process frontend
messages while waiting.

Now we want to handle the inverse problem, where we want to block the
kernel from running other code while waiting for a widget to change.

Consider Python `input` function, which blocks until the user enters
some input.

``` python
name = input("Enter your name:")
print(f"It's very important to know your name, {name}!")
```

    It's very important to know your name, qwerty!

If you’re running this on VSCode or forks, you’ll notice that `input`
works as expected, but its UX is unwieldy with a nearly invisible popout
up at the top of the window.

No problem, `ipywidgets` has a `Text` widget that can be used to get
user input.

``` python
cleanupwidgets('text')

print('(Stop cell execution when you tire of waiting)')

text = W.Text(placeholder='Input your name; enter to submit', continuous_update=False)
display(text)

while True:
    if text.value: break
    time.sleep(0.5)
print(f"It's very important to know your name, {name}!")
```

    (Stop cell execution when you tire of waiting)

    Text(value='', continuous_update=False, placeholder='Input your name; enter to submit')

    KeyboardInterrupt: 
    [0;31m---------------------------------------------------------------------------[0m
    [0;31mKeyboardInterrupt[0m                         Traceback (most recent call last)
    Cell [0;32mIn[37], line 12[0m
    [1;32m     10[0m [38;5;28;01mwhile[39;00m [38;5;28;01mTrue[39;00m:
    [1;32m     11[0m     [38;5;28;01mif[39;00m text[38;5;241m.[39mvalue: [38;5;28;01mbreak[39;00m
    [0;32m---> 12[0m     [43mtime[49m[38;5;241;43m.[39;49m[43msleep[49m[43m([49m[38;5;241;43m0.5[39;49m[43m)[49m
    [1;32m     13[0m [38;5;28mprint[39m([38;5;124mf[39m[38;5;124m"[39m[38;5;124mIt[39m[38;5;124m'[39m[38;5;124ms very important to know your name, [39m[38;5;132;01m{[39;00mname[38;5;132;01m}[39;00m[38;5;124m![39m[38;5;124m"[39m)

    [0;31mKeyboardInterrupt[0m: 

The widget is responsive, but as the kernel is blocked, the messages
coming from the front-end are not processed.

No problem, Asyncio to the rescue.

``` python
cleanupwidgets('text')

async def wait_for_text(text):
    cnt = 0
    while cnt < 10:
        if text.value: return text.value
        await asyncio.sleep(0.5)
        cnt += 1
    return 'unknown'

text = W.Text(placeholder='Enter your name; enter to submit', continuous_update=False)
display(text)

await wait_for_text(text)
print(f"It's very important to know your name, {name}!")
```

    Text(value='', continuous_update=False, placeholder='Enter your name; enter to submit')

    It's very important to know your name, qwerty!

You can try lots of convoluted solutions, but by design is very
difficult to block the kernel using widgets. Crafting modal UIs with
`ipywidgets` is not simple.

**TL;DR**: Use
[jupyter-ui-poll](https://github.com/Kirill888/jupyter-ui-poll/tree/develop)  
\> Block Jupyter cell execution while interacting with widgets.

We want to solve the following problem:

1.  Display User Interface in **Jupyter** using `ipywidgets` or similar
2.  Wait for data to be entered (this step is surprisingly non-trivial
    to implement)
3.  Use entered data in cells below

You want to implement a notebook like the one below

``` python

   # cell 1
   ui = make_ui()
   display(ui)
   data = ui.wait_for_data()

   # cell 2
   do_things_with(data)

   # cell 3.
   do_more_tings()
```

And you want to be able to execute `Cells -> Run All` menu option and
still get correct output.

Jupyter assists in implementing your custom `ui.wait_for_data()` poll
loop. If you have tried implementing such workflow in the past you’ll
know that it is not that simple. If you haven’t, see [Technical
Details](https://github.com/Kirill888/jupyter-ui-poll/tree/develop?tab=readme-ov-file#technical-details)
for an explanation on why it’s hard and how `jupyter-ui-poll` solves it.

Quick, self contained example:

``` python
import time
from ipywidgets import Button
```

``` python
# Set up simple GUI, button with on_click callback
# that sets ui_done=True and changes button text
ui_done = False

def on_click(btn):
    global ui_done
    ui_done = True
    btn.description = '👍'

btn = Button(description='Click Me')
btn.on_click(on_click)
display(btn)

# Wait for user to press the button
with ui_events() as poll:
    while ui_done is False:
        poll(10)  # React to UI events (up to 10 at a time)
        print('.', end='')
        time.sleep(0.1)
print('done')
```

    Button(description='Click Me', style=ButtonStyle())

    .......................done

## `input` with widgets

Now we can develop our pretty `input` function:

------------------------------------------------------------------------

<a href="https://github.com/civvic/pote/blob/main/pote/widget.py#L87"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_user_input

>  get_user_input (prompt='', placeholder='Write something. Enter to
>                      submit', timeout=10.0, widget=None, value=None)

``` python
name = get_user_input('You', placeholder='Input your name; enter to submit', timeout=5.)
Markdown(f"Your intervention has saved the Universe and beyond, **{name}**!")
```

**You**

Your intervention has saved the Universe and beyond, \*\*\*\*!

------------------------------------------------------------------------
</doc><doc title="Logger helpers" desc="Loguru configuration helpers for structured logging (requires pote[logging])"># logger_loguru



Provides pre-configured logging setup using Loguru with
notebook-friendly defaults and hierarchical indentation support for
tracking nested operations.

**Key features:**  
[`config_logger()`](https://civvic.github.io/pote/logger_loguru.html#config_logger)
— One-line setup returning configured logger + tree logger  
[`tree_logger`](https://civvic.github.io/pote/logger_loguru.html#tree_logger)
— Hierarchical logging with automatic indentation (`llogger.push`,
`llogger.pop`)  
[`LogFormatter`](https://civvic.github.io/pote/logger_loguru.html#logformatter)
— Customizable format with indentation support  
[`LogLevelFilter`](https://civvic.github.io/pote/logger_loguru.html#loglevelfilter)
— Dynamic level filtering with temporary override

**When to use:** Need readable, structured logging in notebooks or
scripts with hierarchical context tracking (e.g., nested async
operations, recursive algorithms).

**Typical usage:**

``` python
from loguru import logger
from pote.logger_loguru import config_logger

logger, llogger = config_logger(logger)
llogger.info("root")
with llogger.inc_indent():
    llogger.info("nested")
```


# loguru basics

Quick exploration of loguru’s core features and rationale for this
module’s configuration choices.

Default handler:  
- logs are emitted to `sys.stderr` by default  
- messages can be logged with different severity levels  
- messages are formatted using curly braces (it uses str.format() under
the hood)

``` python
logger.debug("Hello, world! {}", 'aaaa')
```

In notebooks, traces are not good:

``` python
@logger.catch
def f(x): 100 / x  # type: ignore

def g():
    f(10)
    f(0)

g()
```

      ERROR | An error has been caught in function 'g', process 'MainProcess' (43630), thread 'MainThread' (8320000192):

[filter traceback in Jupyter when using
@logger.catch](https://github.com/Delgan/loguru/issues/437)

In notebooks contexts, configure your handler with backtrace option
disabled:

``` python
logger.remove()
logger.add(sys.stderr, backtrace=False)
```

    7

``` python
g()
```

    2025-11-13 14:40:05.849 | ERROR    | __main__:g:6 - An error has been caught in function 'g', process 'MainProcess' (43630), thread 'MainThread' (8320000192):
    Traceback (most recent call last):

      File "/var/folders/np/k2wj6f4s3rj0m9n0yt8pkk680000gn/T/ipykernel_43630/4019600944.py", line 6, in g
        f(0)
        └ <function f>

      File "/var/folders/np/k2wj6f4s3rj0m9n0yt8pkk680000gn/T/ipykernel_43630/4019600944.py", line 2, in f
        def f(x): 100 / x  # type: ignore
            │ │         └ 0
            │ └ 0
            └ <function f>

    ZeroDivisionError: division by zero

Add some colors and formatting to the output:

``` python
logger.remove()
i = logger.add(sys.stderr, colorize=True, format="[<fg #66a3ff>{time:YYYY-MM-DD HH:mm:ss}</fg #66a3ff>] [<fg #00ff00>{level}</fg #00ff00>] {message}")
logger.info("test {}", i)
logger.debug("Hello, world!")
```

    [2025-11-13 14:40:05] [INFO] test 8
    [2025-11-13 14:40:05] [DEBUG] Hello, world!

# formatter

Custom formatter that adds indentation tracking for hierarchical log
output.

------------------------------------------------------------------------

<a
href="https://github.com/civvic/pote/blob/main/pote/logger_loguru.py#L26"
target="_blank" style="float:right; font-size:smaller">source</a>

### LogFormatter

>  LogFormatter ()

*Formats log records with indentation for tree-structured output*

``` python
fmt = LogFormatter()
test_eq(fmt.indent, '')
test_eq(LogFormatter._ind_level, 0)

record = {"extra": {}, "name": "test", "function": "fn", "line": 10}
fmt.format(record)
test_eq(record["extra"]["indent"], '')
record
```

    {'extra': {'indent': ''}, 'name': 'test', 'function': 'fn', 'line': 10}

``` python
LogFormatter._ind_level = 2
fmt2 = LogFormatter()
test_eq(fmt2.indent, '    ')  # 2 levels * 2 spaces
```

``` python
LogFormatter._ind_level = 0  # reset for other tests
```

------------------------------------------------------------------------

<a
href="https://github.com/civvic/pote/blob/main/pote/logger_loguru.py#L48"
target="_blank" style="float:right; font-size:smaller">source</a>

### LogLevelFilter

>  LogLevelFilter (level:int|str)

*Filter log records by minimum level with context manager for temporary
override*

``` python
# ⎸
# LEFT VERTICAL BOX LINE
# Unicode: U+23B8, UTF-8: E2 8E B8

# ⏐
# VERTICAL LINE EXTENSION
# Unicode: U+23D0, UTF-8: E2 8F 90

# │
# BOX DRAWINGS LIGHT VERTICAL
# Unicode: U+2502, UTF-8: E2 94 82
```

# loggers

Wrapper that manages indentation levels for hierarchical log output.

------------------------------------------------------------------------

<a
href="https://github.com/civvic/pote/blob/main/pote/logger_loguru.py#L89"
target="_blank" style="float:right; font-size:smaller">source</a>

### tree_logger

>  tree_logger (logger:Any, fmt:__main__.LogFormatter)

*Logger wrapper managing hierarchical indentation for tree-structured
output*

# setup

> Configuration functions for quick logger setup in library modules

------------------------------------------------------------------------

<a
href="https://github.com/civvic/pote/blob/main/pote/logger_loguru.py#L154"
target="_blank" style="float:right; font-size:smaller">source</a>

### setup_logger

>  setup_logger (logger, name='__main__')

*Apply standard config (format, level filter, backtrace) to logger*

<s>Note logging is disabled after
[`setup_logger`](https://civvic.github.io/pote/logger_loguru.html#setup_logger)
if called from a module distinct to ‘**main**’.</s>

``` python
logger = setup_logger(logger)
logger.info('test')
```

       INFO | test

------------------------------------------------------------------------

<a
href="https://github.com/civvic/pote/blob/main/pote/logger_loguru.py#L160"
target="_blank" style="float:right; font-size:smaller">source</a>

### config_logger

>  config_logger (logger:loguru._logger.Logger)

*Configure logger with colors and return (logger, tree_logger) tuple*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>logger</td>
<td>Logger</td>
<td>Logger instance from each module</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>tuple</strong></td>
<td></td>
</tr>
</tbody>
</table>

**Module usage pattern:**

Each module imports and configures its own logger:

``` python
from loguru import logger
from pote.logger_loguru import config_logger

logger, llogger = config_logger(logger)

# Standard logging
logger.info("Processing started")

# Hierarchical logging  
llogger.info("Main operation")
with llogger.inc_indent():
    llogger.info("Sub-operation")
```

This gives each module independent logger configuration while
maintaining consistent formatting.

``` python
logger, llogger = config_logger(logger)
logger.info('configured')
```

       INFO | configured

``` python
test_eq(llogger.level, 0)
test_eq(llogger.indent, '')
llogger.info('root level')
```

       INFO | root level

``` python
_ = llogger.push
llogger.info("pushed once")
test_eq(llogger.level, 1)
test_eq(llogger.indent, '│ ')
```

       INFO | │ pushed once

``` python
_ = llogger.push
llogger.info("pushed twice")
test_eq(llogger.level, 2)
test_eq(llogger.indent, '│ │ ')
```

       INFO | │ │ pushed twice

``` python
_ = llogger.pop
test_eq(llogger.level, 1)
```

``` python
_ = llogger.reset()
test_eq(llogger.level, 0)
```

``` python
llogger.info('root')
with llogger.inc_indent():
    test_eq(llogger.level, 1)
    llogger.info('child')
    with llogger.inc_indent():
        test_eq(llogger.level, 2)
        llogger.info('grandchild')
    test_eq(llogger.level, 1)
    llogger.info('child')
test_eq(llogger.level, 0)
llogger.info('root')
```

       INFO | root
       INFO | │ child
       INFO | │ │ grandchild
       INFO | │ child
       INFO | root

``` python
class _Test:
    a = 'a'
    b = 'b'
    
    @llogger.bracket_logging("<n>{}</> <y>{}</>", 'test', b'b')
    async def test_bracket_logging_b(self):
        llogger.info("inside test_bracket_logging_b")
        test_eq(llogger.level, 2)  # nested 2 levels deep
        
    @llogger.bracket_logging("<n>{}</> <y>{}</>", 'test', b'a')
    async def test_bracket_logging_a(self):
        llogger.info("inside test_bracket_logging_a")
        test_eq(llogger.level, 1)  # nested 1 level
        await self.test_bracket_logging_b()  # type: ignore
        test_eq(llogger.level, 1)  # back to 1 after inner returns

_t = _Test()
llogger.reset()
test_eq(llogger.level, 0)
await _t.test_bracket_logging_a()  # type: ignore
test_eq(llogger.level, 0)  # back to root
```

       INFO | test a: >>>> test_bracket_logging_a...
       INFO | │ inside test_bracket_logging_a
       INFO | │ test b: >>>> test_bracket_logging_b...
       INFO | │ │ inside test_bracket_logging_b

bracket_logging decorator with nested calls

## <!-- # Colophon --></doc></optional></project>
